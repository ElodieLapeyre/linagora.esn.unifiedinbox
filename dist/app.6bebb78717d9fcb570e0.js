!function(e){var n={};function t(i){if(n[i])return n[i].exports;var o=n[i]={i:i,l:!1,exports:{}};return e[i].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,i){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:i})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(t.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(i,o,function(n){return e[n]}.bind(null,o));return i},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}({"+8Hg":function(e,n){!function(e){"use strict";function n(e){return{addForwarding:function(n){return e.all("forwardings").customPUT({forwarding:n})},addUserForwarding:function(n,t,i){return e.one("forwardings/users",t).customPUT({forwarding:n},null,{domain_id:i})},list:function(){return e.all("forwardings").getList()},listUserForwardings:function(n,t){return e.one("forwardings/users",n).getList(null,{domain_id:t})},removeForwarding:function(n){return e.all("forwardings").customOperation("remove","",{},{"Content-Type":"application/json"},{forwarding:n})},removeUserForwarding:function(n,t,i){return e.one("forwardings/users",t).customOperation("remove","",{domain_id:i},{"Content-Type":"application/json"},{forwarding:n})},updateForwardingConfigurations:function(n,t){var i={scope:"domain",domain_id:n};return e.all("forwardings").one("configurations").customPUT(t,null,i)}}}n.$inject=["inboxRestangular"],e.module("linagora.esn.unifiedinbox").factory("inboxForwardingClient",n)}(angular)},"+oQr":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposer",{templateUrl:function(e,n){return"/unifiedinbox/app/components/composer/"+n.template},controller:"inboxComposerController",bindings:{message:"<",onSend:"&",onSave:"&",onDiscard:"&",onHide:"&",onShow:"&",onMessageIdUpdate:"&",onTitleUpdate:"&",onTryClose:"&",forceClose:"&"}})}()},"/nKy":function(e,n){!function(e){"use strict";function n(e){var n=new e.DynamicDirective(!0,"inbox-forwardings-user",{attributes:[{name:"user",value:"member"}]});e.addInjection("admin-user-list-menu-items",n)}n.$inject=["dynamicDirectiveService"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},"/oDd":function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").directive("dragulaDisableScrollOn",["touchscreenDetectorService",function(e){return{restrict:"A",link:function(n,t,i){var o=!0,r=i.dragulaDisableScrollOn;function a(e){o||e.preventDefault()}e.hasTouchscreen()&&(document.addEventListener("touchmove",a,{passive:!1}),n.$on(r+".drag",(function(){o=!1}))),n.$on(r+".drop-model",(function(){o=!0})),n.$on("$destroy",(function(){document.removeEventListener("touchmove",a)}))}}}])}(angular)},"/uBX":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").filter("inboxFilterVisibleSharedMailboxes",["_","inboxSharedMailboxesService",function(e,n){return function(t){return e.filter(t,(function(e){return n.isShared(e)&&!(!1===e.isDisplayed)}))}}])}()},0:function(e,n,t){t("fjLs"),t("4GOk"),t("AlhZ"),t("R4B8"),t("xuUh"),t("Hrwg"),t("adBT"),t("RVy9"),t("VqdP"),t("P/4S"),t("ghTf"),t("yx6k"),t("PkBJ"),t("BlA8"),t("v0Om"),t("sOZ5"),t("+oQr"),t("dyjM"),t("b+6A"),t("XKdh"),t("O7Xo"),t("oiXd"),t("ZOBe"),t("bvNq"),t("Mb4b"),t("kcuL"),t("AyT3"),t("upAi"),t("bQvj"),t("DxxY"),t("9+3P"),t("DKwc"),t("b23R"),t("p4Rh"),t("vSqU"),t("T05Q"),t("f5ji"),t("LgMB"),t("Ll+L"),t("y97W"),t("1nxj"),t("uFIX"),t("r2TF"),t("/nKy"),t("9ReR"),t("gYBJ"),t("P1FX"),t("fkWO"),t("XW/p"),t("yxnX"),t("l4q6"),t("i2WX"),t("jXrA"),t("PuUy"),t("x0CY"),t("0/Nw"),t("RbOY"),t("B5J7"),t("x/4Y"),t("NvQQ"),t("UZXN"),t("17ej"),t("RTID"),t("ZMjP"),t("hk4e"),t("jqKX"),t("WfCr"),t("OEIk"),t("BsHp"),t("IgyH"),t("p4hc"),t("mlVu"),t("CjMo"),t("dIHu"),t("KHHp"),t("3SGq"),t("BZvW"),t("mTo6"),t("Rr/l"),t("7xoy"),t("kghp"),t("Ra0Y"),t("ueGl"),t("LxKL"),t("Onhv"),t("zFhF"),t("b7P1"),t("iAHR"),t("tZti"),t("X5Fm"),t("Uta4"),t("nlxQ"),t("lQBM"),t("vapZ"),t("MWHR"),t("JbyE"),t("Edxa"),t("V+BJ"),t("fxcb"),t("iPUv"),t("/oDd"),t("uRHS"),t("qzXX"),t("utKG"),t("yWm4"),t("yOLm"),t("38HG"),t("iyyT"),t("pZJQ"),t("wVTr"),t("/uBX"),t("fmes"),t("kndV"),t("ltRY"),t("dzZ9"),t("Ma83"),t("2Rtw"),t("8LPj"),t("z33q"),t("ZYuZ"),t("y55o"),t("jCtF"),t("DW8A"),t("geLP"),t("XKQ6"),t("Xmid"),t("P7VL"),t("khNc"),t("zk79"),t("Z4qW"),t("IXVk"),t("MNGc"),t("rM/8"),t("hlIG"),t("kfBz"),t("E0jM"),t("sCbM"),t("nBjT"),t("PVpr"),t("C5+h"),t("eLcg"),t("bF2/"),t("+8Hg"),t("rspv"),t("voSL"),t("bTq2"),t("yS6E"),t("RvFt"),t("cdbx"),t("RvdB"),t("Rmve"),t("5osW"),t("MvW8"),t("3NVN"),t("BzSa"),t("HurS"),t("Qe7P"),t("svsH"),t("7MRb"),t("jQpN"),t("Kagd"),t("qJN7"),t("H4Be"),t("HcpP"),t("gBiR"),t("jjVl"),t("vhC1"),t("HwEM"),t("R+Am"),t("QEQK"),t("HSVf"),t("Pnvo"),t("qZP/"),t("qyDE"),t("fO1n"),t("CvKQ"),t("uYJZ"),t("I48O"),t("kJSp"),t("jDXc"),t("4SUc"),e.exports=t("MbdB")},"0/Nw":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxIdentityController",["$modal",function(e){var n=this;n.onEditBtnClick=function(){e({templateUrl:"/unifiedinbox/app/components/inbox-configuration/identity/edit/inbox-identity-edit.html",backdrop:"static",placement:"center",controllerAs:"$ctrl",controller:"inboxIdentityEditController",locals:{identity:n.identity,userId:n.user._id}})},n.onRemoveBtnClick=function(){e({templateUrl:"/unifiedinbox/app/components/inbox-configuration/identity/remove/inbox-identity-remove.html",backdrop:"static",placement:"center",controllerAs:"$ctrl",controller:"inboxIdentityRemoveController",locals:{identity:n.identity,userId:n.user._id}})}}])}()},"17ej":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxRequestReadReceipts",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/read-receipt/request-receipts/request-receipts.html",controller:"inboxRequestReadReceiptsController"})}()},"1nxj":function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxForwardingsSubheader",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/forwardings/subheader/inbox-forwardings-subheader.html",bindings:{forwardings:"<",onSave:"&"}})}(angular)},"2Rtw":function(e,n){!function(e){"use strict";function n(e){var n=this;n.$onInit=function(){!e.isEmpty(n.query.text)&&e.isEmpty(n.query.advanced.contains)&&(n.query.advanced.contains=n.query.text)}}n.$inject=["_"],e.module("linagora.esn.unifiedinbox").controller("inboxSearchFormController",n)}(angular)},"38HG":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").filter("inboxFilterDescendantMailboxes",["_",function(e){return function(n,t,i){if(!n||!t)return n;var o,r=e.find(n,{id:t});return r?(i||(o=r.descendants),e.filter(n,(function(n){return n.id!==t&&(i||!e.find(o,{id:n.id}))}))):n}}])}()},"3NVN":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("inboxJmapItemService",["$q","$rootScope","session","newComposerService","emailSendingService","withJmapClient","jmapDraft","inboxMailboxesService","infiniteListService","inboxSelectionService","asyncJmapAction","notificationFactory","_","esnI18nService","INBOX_EVENTS","INBOX_DISPLAY_NAME_SIZE","inboxFilteredList","inboxConfig","uuid4","INBOX_DEFAULT_NUMBER_ITEMS_PER_PAGE_ON_BULK_READ_OPERATIONS","INBOX_DEFAULT_NUMBER_ITEMS_PER_PAGE_ON_BULK_DELETE_OPERATIONS","INBOX_DEFAULT_NUMBER_ITEMS_PER_PAGE_ON_BULK_UPDATE_OPERATIONS",function(e,n,t,i,o,r,a,s,u,l,c,d,f,m,p,g,b,h,x,v,E,S){return{reply:function(e){o.createReplyEmailObject(e.id,t.user).then((function(e){i.open(e)}))},replyAll:function(e){o.createReplyAllEmailObject(e.id,t.user).then((function(e){i.open(e)}))},forward:function(e){o.createForwardEmailObject(e.id,t.user).then((function(e){i.open(e)}))},ackReceipt:function(n,t){var i="function"!=typeof t?x.generate:t;return c({success:"A read receipt has been sent.",failure:"Could not send the read receipt."},(function(t){return function(n,t){var i,o={};if("function"!=typeof n)return e.reject(new Error("Missing request id provider for sending MDN acks"));if(!(t&&t.id&&t.from&&t.from.email))return e.reject(new Error("Cannot build acknowledgement for provided message: "+JSON.stringify(t)));if(!(i=n()))return e.reject(new Error("Could not create an identifier for sendMDN request "));return o[i]={messageId:t.id,subject:m.translate("Read: %s",t.subject).toString(),textBody:m.translate("To: %s",t.from.email)+"\n"+m.translate("Subject: %s",t.subject||"")+"\n"+m.translate("Message was displayed on %s",new Date(Date.now()).toString()),reportingUA:"OpenPaaS Unified Inbox",disposition:{actionMode:"manual-action",sendingMode:"MDN-sent-manually",type:"displayed"}},e.when({sendMDN:o})}(i,n).then(t.setMessages.bind(t)).then((function(n){if(!f.isEmpty(n.MDNNotSent))return e.reject(new Error("Could not send the read receipt."))}))}))},markAsUnread:function(e){return this.setFlag(e,"isUnread",!0)},markAsRead:function(e){return this.setFlag(e,"isUnread",!1)},markAsFlagged:function(e){return this.setFlag(e,"isFlagged",!0)},unmarkAsFlagged:function(e){return this.setFlag(e,"isFlagged",!1)},moveToTrash:function(e){return I(e,a.MailboxRole.TRASH)},moveToSpam:function(e){return I(e,a.MailboxRole.SPAM)},unSpam:function(e){return I(e,a.MailboxRole.INBOX)},moveToMailbox:T,moveMultipleItems:R,downloadEML:function(n){var t=f.isArray(n)?n[0]:n;if(!t)return e.reject(new Error("No message provided for downloading !"));var i=(o=t.subject,r=g,(o=o||m.translate("(No subject)").toString()).substr(0,r-1)+(o.length>r?"â€¦":""));var o,r;return c({progressing:m.translate('Downloading message "%s"...',i),success:m.translate('Message "%s" successfully downloaded',i),failure:m.translate('Could not download message "%s"',i)},(function(e){var n=encodeURIComponent(i+".eml");return new a.Attachment(e,t.blobId,{name:n}).getSignedDownloadUrl()}))},setFlag:function(t,i,o){var r=f.isArray(t)?t:[t],a=f.indexBy(r,(function(e){return e[i]=o,e.id}));return n.$broadcast(p.ITEM_FLAG_CHANGED,r,i,o),c({failure:r.length>1?"Some items could not be updated":m.translate('Could not update "%s"',r[0].subject)},(function(t){return t.setMessages({update:f.mapValues(a,f.constant(f.zipObject([i],[o])))}).then(A).catch((function(t){var r=f.map(t.notUpdated,(function(e,n){return a[n][i]=!o,a[n]}));return n.$broadcast(p.ITEM_FLAG_CHANGED,r,i,!o),e.reject(t)}))}),{silent:!0})},emptyMailbox:function(t){return s.getMessageListFilter(t).then((function(i){return n.$broadcast(p.BADGE_LOADING_ACTIVATED,t),h("numberItemsPerPageOnBulkReadOperations",v).then((function(o){return _(i,o).then((function(n){return c({success:m.translate("Trash is empty"),progressing:m.translate("Empty trash in progress")},(function(){return h("numberItemsPerPageOnBulkDeleteOperations",E).then((function(t){return function(n,t){var i=n.slice();return function n(){if(!i.length)return e.resolve(!0);var o=i.splice(0,t);return r((function(e){return e.destroyMessages(o).then((function(){return b.removeFromList(o),n()})).catch(n)}))}()}(n,t)}))}))})).catch((function(){d.weakError("error",m.translate("Empty the trash failed"))})).finally((function(){n.$broadcast(p.BADGE_LOADING_ACTIVATED,!1),s.emptyMailbox(t)}))}))}))},markAllAsRead:function(e){return this.setAllFlag(e,"isUnread",!1)},setAllFlag:function(t,i,o){return s.getMessageListFilter(t,{isUnread:!0}).then((function(a){return n.$broadcast(p.BADGE_LOADING_ACTIVATED,t),h("numberItemsPerPageOnBulkReadOperations",v).then((function(u){return _(a,u).then((function(a){return c({success:m.translate("All messages in folder have been marked as read"),progressing:m.translate("Mark all as read in progress ..."),failure:m.translate("Failed to mark folder messages as read")},(function(){return h("numberItemsPerPageOnBulkUpdateOperations",S).then((function(n){return function(n,t,i,o){return function a(){if(!n.length)return e.resolve(!0);var s=n.splice(0,o);return r((function(e){return e.setMessages({update:s.reduce((function(e,n){return e[n]=f.zipObject([t],[i]),e}),{})}).then((function(){return b.updateFlagFromList(s,t,i),a()})).catch(a)}))}()}(a,i,o,n)})).then((function(){n.$broadcast(p.BADGE_LOADING_ACTIVATED,!1),s.markAllAsRead(t)}))}))}))}))}))},getVacationActivated:function(){return r((function(e){return e.getVacationResponse().then((function(e){return e.isActivated}))}))},disableVacation:function(){return c("Modification of vacation settings",(function(e){return e.setVacationResponse(new a.VacationResponse(e,{isEnabled:!1})).then((function(){n.$broadcast(p.VACATION_STATUS)}))}))}};function A(n){if(!f.isEmpty(n.notUpdated))return e.reject(n)}function I(e,n){return s.getMailboxWithRole(n).then((function(n){return R(e,n)}))}function y(e,n){e.oldMailboxIds=e.mailboxIds,e.mailboxIds=n}function T(t,i){var o=[i.id],r=angular.isArray(t)?t:[t],a=f.indexBy(r,(function(e){return s.updateCountersWhenMovingMessage(e,o),y(e,o),e.id}));return n.$broadcast(p.ITEM_MAILBOX_IDS_CHANGED,r),c({failure:r.length>1?m.translate('Some items could not be moved to "%s"',i.displayName):m.translate('Cannot move "%s" to "%s"',r[0].subject,i.displayName)},(function(t){return t.setMessages({update:f.mapValues(a,f.constant({mailboxIds:o}))}).then(A).catch((function(t){var i=f.map(t.notUpdated,(function(e,n){var t=a[n];return s.updateCountersWhenMovingMessage(t,t.oldMailboxIds),y(t,t.oldMailboxIds),t}));return n.$broadcast(p.ITEM_MAILBOX_IDS_CHANGED,i),e.reject(t)}))}),{silent:!0})}function _(e,n){var t=[],i=0;return function o(){return r((function(r){return r.getMessageList({filter:e,limit:n,position:i}).then((function(e){var r=e.messageIds;return r.length>0&&(t=t.concat(r)),r.length<n?t:(i+=n,o())}))}))}()}function R(e,n){var t=angular.isArray(e)?e:[e];return l.unselectAllItems(),u.actionRemovingElements((function(){return T(t,n)}),t,(function(e){return t.filter((function(n){return e.notUpdated?e.notUpdated[n.id]:n}))}))}}])}()},"3SGq":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxMessageBodyText",{templateUrl:"/unifiedinbox/app/components/message-body/text/message-body-text.html",bindings:{message:"<"}})}()},"4GOk":function(e,n){!function(e){"use strict";function n(e){var n=this;n.$onInit=function(){n.files=e.files,n.humanReadableMaxSizeUpload=e.humanReadableMaxSizeUpload,n.externalAttachmentProviders=e.externalAttachmentProviders,n.showProviderSelection=n.externalAttachmentProviders.length>1,n.selectedProvider=n.externalAttachmentProviders[0]},n.upload=function(){var t=n.files.map((function(e){return e.getFile()}));e.onUpload(n.selectedProvider,t)},n.cancel=function(){e.onCancel&&e.onCancel()}}n.$inject=["modalData"],e.module("linagora.esn.unifiedinbox").controller("inboxAttachmentAlternativeUploaderModalController",n)}(angular)},"4SUc":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("inboxUserQuotaService",["$q","_","inboxMailboxesService","INBOX_QUOTA_LEVEL_THRESHOLDS",function(e,n,t,i){return{getUserQuotaInfo:function(){return t.getUserInbox().then((function(t){return!t||n.size(t.quotas)<1?e.reject(new Error("Could not find any quota info")):e.when(function(e){var t=n.head(n.values(e.quotas));if(!t)return{};var o={usedStorage:t.STORAGE&&t.STORAGE.used||0,maxStorage:t.STORAGE&&t.STORAGE.max};if(o.maxStorage){o.storageRatio=Math.round(o.usedStorage/o.maxStorage*100);var r=i.major,a=i.critical;o.storageRatio>=r?o.quotaLevel="major":o.storageRatio>=a&&(o.quotaLevel="critical")}return o}(t))}))}}}])}()},"5osW":function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").factory("jmapDraft",["$window",function(e){return e.jmapDraft}]).factory("dollarQPromiseProvider",["$q",function(e){return{newPromise:function(n){return e(n)}}}]).factory("dollarHttpTransport",["$http",function(e){return{post:function(n,t,i){return e.post(n,i,{headers:t}).then((function(e){return e.data}))}}}])}(angular)},"7MRb":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("inboxSharedMailboxesPermissionsService",["$q","_","inboxMailboxesService","INBOX_PERSONAL_MAILBOX_NAMESPACE_TYPE","INBOX_MAILBOX_SHARING_ROLES","INBOX_MAILBOX_SHARING_PERMISSIONS",function(e,n,t,i,o,r){var a,s=(a=n.mapValues(r,(function(e){return e.sort()})),n.invert(a));return{grant:c,grantDefaultRole:function(e,n){return c(d(),e,n)},grantAndUpdate:function(e,i,o){var r=n.cloneDeep(i);return c(e,i,o).then(n.partial(t.updateMailbox,r)).then(n.constant(i))},revoke:f,revokeAndUpdate:function(e,i){var o=n.cloneDeep(e);return f(e,i).then(n.partial(t.updateMailbox,o)).then(n.constant(e))},getRole:function(t,i){if(!l(t))return e.reject(new Error("invalid mailbox provided"));if(!i)return e.reject(new Error("user email not provided"));var o=((t.sharedWith||{})[i]||[]).sort();return n.has(s,o)?e.when(s[o]):e.reject(new Error("No role found for provided shared folder's permission: "+o))},getDefaultRole:d};function u(e){return e&&e.namespace&&e.namespace.type&&e.namespace.type.toLowerCase()===i}function l(e){return e&&e.id&&e.name}function c(t,i,o){return n.has(r,t)?l(i)?u(i)?o?(i.sharedWith=i.sharedWith||{},i.sharedWith[o]=r[t],e.when(i)):e.reject(new Error("user email not provided")):e.reject(new Error("Only user "+(i.namespace&&i.namespace.owner||"")+" is allowed to update sharing settings")):e.reject(new Error("invalid mailbox provided")):e.reject(new Error('"'+t+'" role was not found'))}function d(){return o.READ_AND_UPDATE}function f(t,i){return l(t)?u(t)?i?n.has(t.sharedWith,i)?(delete t.sharedWith[i],e.when(t)):e.reject(new Error('"'+i+'" had not been granted yet!')):e.reject(new Error("user email not provided")):e.reject(new Error("Only user "+(t.namespace&&t.namespace.owner||"")+" is allowed to update sharing settings")):e.reject(new Error("invalid mailbox provided"))}}])}()},"7xoy":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSharedMailbox",{templateUrl:"/unifiedinbox/app/components/shared-mailboxes/shared-mailbox/shared-mailbox.html",bindings:{mailbox:"="}})}()},"8LPj":function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r,a){var s=i.account,u=i.context||e.item&&t.first(e.item.mailboxIds),l=a.get("jmap");l&&l.resolveContextRole(s,u).then((function(n){e.mailboxRole=n})),e.mailbox=i.mailbox||e.mailbox&&e.mailbox.id||e.item&&t.first(e.item.mailboxIds),e.email=e.item,n.all(t.map(e.item.mailboxIds,(function(n){return r.assignMailbox(n,e,!0)}))).then((function(n){e.item.mailboxes=n})),this.openDraft=function(e){o.openDraft(e)}}n.$inject=["$scope","$q","_","$stateParams","newComposerService","inboxMailboxesService","inboxPlugins"],e.module("linagora.esn.unifiedinbox").controller("inboxSearchMessageListItemController",n)}(angular)},"9+3P":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxFilterDefinitionSubheader",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/filter-definition/subheader/filter-definition-subheader.html",bindings:{onSave:"&",isEditMode:"<"}})}()},"9ReR":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxIdentitiesController",["$q","$modal","$scope","inboxIdentitiesService","INBOX_IDENTITIES_EVENTS",function(e,n,t,i,o){var r=this;function a(e,n){r.identities=n}r.$onInit=function(){r.status="loading",e.all([i.canEditIdentities(),i.getAllIdentities(r.user._id)]).then((function(e){r.status="loaded",r.canEdit=e[0],r.identities=e[1],t.$on(o.UPDATED,a)})).catch((function(){r.status="error"}))},r.openCreateForm=function(){n({templateUrl:"/unifiedinbox/app/components/inbox-configuration/identity/create/inbox-identity-create.html",backdrop:"static",placement:"center",controllerAs:"$ctrl",controller:"inboxIdentityCreateController",locals:{userId:r.user._id}})}}])}()},AlhZ:function(e,n){!function(e){"use strict";n.$inject=["$modal","inboxAttachmentProviderRegistry","INBOX_ATTACHMENT_TYPE_JMAP"],e.module("linagora.esn.unifiedinbox").factory("inboxAttachmentAlternativeUploaderModal",n);function n(e,n,t){return{show:function(i,o,r,a){var s=n.getAll(),u=Object.keys(s).filter((function(e){return e!==t})).map((function(e){return s[e]})),l=Object.keys(u).length>0?"/unifiedinbox/app/components/attachment-alternative-uploader/attachment-alternative-uploader-modal.html":"/unifiedinbox/app/components/attachment-alternative-uploader/attachment-alternative-uploader-modal-no-uploader.html",c={files:i.map((function(e){return{name:e.name,size:e.size,getFile:function(){return e}}})),humanReadableMaxSizeUpload:o,externalAttachmentProviders:u,onUpload:r,onCancel:a};e({templateUrl:l,container:"body",backdrop:"static",placement:"center",controller:"inboxAttachmentAlternativeUploaderModalController",controllerAs:"$ctrl",locals:{modalData:c}})}}}}(angular)},AyT3:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxConfiguration",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/configuration.html",controller:"inboxConfigurationController"})}(angular)},B5J7:function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r){var a=this;a.init=function(){a.identity=t},a.onRemoveBtnClick=function(){return n({progressing:"Removing identity...",success:"Identity removed",failure:"Failed to remove identity"},(function(){return o.removeIdentity(a.identity.uuid,i).then((function(n){e.$broadcast(r.UPDATED,n)}))}))}}n.$inject=["$rootScope","asyncAction","identity","userId","inboxIdentitiesService","INBOX_IDENTITIES_EVENTS"],e.module("linagora.esn.unifiedinbox").controller("inboxIdentityRemoveController",n)}(angular)},BZvW:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxPreferencesMailtoController",["$window","session","esnUserConfigurationService","absoluteUrl","INBOX_MODULE_NAME",function(e,n,t,i,o){var r=this,a=i("/unifiedinbox/mailto?uri=%s");r.$onInit=function(){t.get(["useEmailLinks"],o).then((function(e){angular.forEach(e,(function(e){r[e.name]=e.value}))})),r.parent.registerSaveHandler((function(){return t.set([{name:"useEmailLinks",value:!!r.useEmailLinks}],o).then((function(){r.useEmailLinks||e.navigator.unregisterProtocolHandler&&e.navigator.unregisterProtocolHandler("mailto",a)}))}))},r.authorizeBrowser=function(){e.navigator.registerProtocolHandler("mailto",a,"OpenPaaS")},r.mailtoTargetEmail=n.user.preferredEmail}])}()},BlA8:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposerBodyEditorText",{templateUrl:"/unifiedinbox/app/components/composer/body-editor/text/composer-body-editor-text.html",controller:"inboxComposerBodyEditorTextController",bindings:{message:"<",identity:"<",isCollapsed:"<",onBodyUpdate:"&"}})}()},BsHp:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxMaiboxSharedSettings",{templateUrl:"/unifiedinbox/app/components/mailbox-shared-settings/mailbox-shared-settings.html",controllerAs:"ctrl",controller:"InboxMailboxSharedSettingsController"})},BzSa:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("JMAP_FILTER",{CONDITIONS:{FROM:{JMAP_KEY:"from",HUMAN_REPRESENTATION:"is from %s"},TO:{JMAP_KEY:"to",HUMAN_REPRESENTATION:"is addressed to %s"},CC:{JMAP_KEY:"cc",HUMAN_REPRESENTATION:"is cc'd to %s"},RECIPIENT:{JMAP_KEY:"recipient",HUMAN_REPRESENTATION:"is addressed or cc'd to %s"},SUBJECT:{JMAP_KEY:"subject",HUMAN_REPRESENTATION:"has subject containing %s"}},CONDITIONS_MAPPING:{from:"FROM",to:"TO",cc:"CC",recipient:"RECIPIENT",subject:"SUBJECT"},ACTIONS:{MOVE_TO:{JMAP_KEY:"appendIn",HUMAN_REPRESENTATION:"move to destination folder %s"}},ACTIONS_MAPPING:{appendIn:"MOVE_TO"}})}()},"C5+h":function(e,n){!function(){"use strict";function e(e,n,t,i,o,r,a){var s=[],u={},l=n.defer(),c=[];return l.resolve(!0),e.$on(r.FILTER_CHANGED,f),e.$on(r.ITEM_FLAG_CHANGED,f),e.$on(r.ITEM_MAILBOX_IDS_CHANGED,f),e.$on(r.DRAFT_DESTROYED,(function(e,n){d([n.id])})),{list:function(){return c},reset:function(){s.length=0,c.length=0,u={}},getById:function(e){return u[e]},addAll:function(e){var n=i.isFilteringActive();e.forEach((function(e){u[e.id]||(e.fetchedWhileFiltering=n,u[e.id]=e,s.splice(o.sortedIndex(s,e,(function(e){return-new Date(e.date).getTime()})),0,e))})),f()},asMdVirtualRepeatModel:function(e){return{getItemAtIndex:function(n){return n>c.length-a&&e(),c[n]},getLength:function(){return c.length}}},removeFromList:d,removeMessagesFromProvider:function(e){d((o.filter(s,(function(n){return n.provider.id===e.id}))||[]).map((function(e){return e.id})))},updateFlagFromList:function(e,n,t){e.forEach((function(e){u[e]&&(u[e][n]=t)}))}};function d(e){var n=[];return e.forEach((function(e){u[e]&&(n.push(u[e]),o.remove(s,(function(n){return n.id===e})),delete u[e])})),f(),n}function f(){var e;c.length=0,i.isFilteringActive()||(e=o.filter(s,{fetchedWhileFiltering:!0}),o.forEach(e,(function(e){o.pull(s,e),delete u[e.id]}))),n.all(s.map(m.bind(null,i.getAllProviderFilters()))).then((function(e){o.forEach(e,(function(e,n){if(!e){var t=s[n];if(t.previous=null,t.next=null,c.length>0){var i=c[c.length-1];i.next=function(){return t},t.previous=function(){return i}}c.push(t)}}))}))}function m(e,i){var r=i.provider;return p(r.types,e.acceptedTypes).then((function(){return p([r.account],e.acceptedAccounts)})).then((function(){return r.options&&r.options.itemMatches?r.options.itemMatches(i,e):l})).then((function(){if(e.quickFilter)return function(e,i){return n((function(n,o){t([e],{$:i}).length>0?n():o()}))}(i,e.quickFilter)})).then(o.constant(!1),o.constant(!0))}function p(e,t){return n((function(n,i){if(!t)return n();o.some(e,(function(e){return o.contains(t,e)}))?n():i()}))}}e.$inject=["$rootScope","$q","filterFilter","inboxFilteringService","_","INBOX_EVENTS","VIRTUAL_SCROLL_DISTANCE"],angular.module("linagora.esn.unifiedinbox").factory("inboxFilteredList",e)}()},CjMo:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").controller("inboxMessageBodyHtmlController",["$timeout","$q","newComposerService","_",function(n,t,i,o){var r=this;r.$onInit=o.partial(n,(function(){document.querySelectorAll('.inbox-message-body-html a[href^="mailto:"]').forEach((function(n){var t=e.element(n),i=t.attr("href").replace(/^mailto:/,"");t.on("click",o.partialRight(r.mailtoCallback,i))})),r.loadAsyncImages()})),r.mailtoCallback=function(e,n){e.preventDefault(),e.stopPropagation(),i.open({to:[{email:n,name:n}]})},r.loadAsyncImages=function(){var e=function(e){return e?e.getSignedDownloadUrl():t.when("broken-link")},n=Array.prototype.map.call(document.querySelectorAll("img[data-async-src]"),(function(n){var i=n.getAttribute("data-async-src");return n.removeAttribute("data-async-src"),i.match(/^cid:/)?t.when(o.find(r.message.attachments,{cid:i.replace("cid:","")})).then(e).then((function(e){n.src=e})):(n.src=i,t.when())}));return t.all(n)}}])}(angular)},CvKQ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("INBOX_RECEIPTS_CONFIG_KEY","requestReceipts")}()},DKwc:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxConfigurationFilters",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/filters/configuration-filters.html",controller:"inboxConfigurationFiltersController"})}()},DW8A:function(e,n){!function(e){"use strict";function n(e,n,t){var i=e("/unifiedinbox/app/search/provider/search-results-provider.html",n);return i.onSubmit=t,i}n.$inject=["inboxNewMessageProvider","computeUniqueSetOfRecipients","inboxSearchResultsProviderSubmit"],e.module("linagora.esn.unifiedinbox").factory("inboxSearchResultsProvider",n)}(angular)},DxxY:function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r,a){var s=this;function u(e){return Object.keys(e).map((function(n){return{key:e[n].JMAP_KEY,val:o.translate(e[n].HUMAN_REPRESENTATION,"").toString()}}))}function l(e,t,i){return n.has(e,t)?e[t]:i}function c(e){return r.getUsersByEmail(e.condition.value).then((function(n){if(!n.data||!n.data[0])return s.newFilter.stakeholders=[{email:e.condition.value,name:e.condition.value}],s.newFilter.stakeholders;var t=l(n.data[0],"preferredEmail",e.condition.value),i=l(n.data[0],"firstname",e.condition.value)+" "+l(n.data[0],"lastname","");return s.newFilter.stakeholders=[{email:t,name:i}],s.newFilter.stakeholders})).catch((function(){return s.newFilter.stakeholders=[{email:e.condition.value,name:e.condition.value}],s.newFilter.stakeholders}))}function d(e){s.assignMailboxesListPromise.then((function(){s.newFilter.moveTo=n.find(s.mailboxes,{id:e.action.appendIn.mailboxIds[0]})}))}s.newFilter={},s.$onInit=function(){s.assignMailboxesListPromise=t.assignMailboxesList(s),s.conditionsOptions=u(a.CONDITIONS),s.actionOptions=u(a.ACTIONS),s.newFilter.when=function(){return n.find(s.conditionsOptions,{key:a.CONDITIONS.FROM.JMAP_KEY})}(),s.newFilter.then=function(){return n.find(s.actionOptions,{key:a.ACTIONS.MOVE_TO.JMAP_KEY})}(),s.editFilterId&&s.initEditForm()},s.hideMoreResults=function(){return n.has(s.newFilter,"stakeholders")&&!n.isEmpty(s.newFilter.stakeholders)},s.hideRecipientsAutoComplete=function(){return s.newFilter.when.key!==a.CONDITIONS.FROM.JMAP_KEY&&s.newFilter.when.key!==a.CONDITIONS.TO.JMAP_KEY&&s.newFilter.when.key!==a.CONDITIONS.CC.JMAP_KEY&&s.newFilter.when.key!==a.CONDITIONS.RECIPIENT.JMAP_KEY},s.initEditForm=function(){return i.getFilters().then((function(){var e=l(i.filtersIds,s.editFilterId);if(e){var t=Object.keys(e.action)[0];switch(s.newFilter={name:e.name,when:n.find(s.conditionsOptions,{key:e.condition.field}),then:n.find(s.actionOptions,{key:t})},e.condition.field){case a.CONDITIONS.FROM.JMAP_KEY:case a.CONDITIONS.TO.JMAP_KEY:case a.CONDITIONS.CC.JMAP_KEY:case a.CONDITIONS.RECIPIENT.JMAP_KEY:c(e);break;case a.CONDITIONS.SUBJECT.JMAP_KEY:s.newFilter.subject=e.condition.value}switch(t){case a.ACTIONS.MOVE_TO.JMAP_KEY:d(e)}}}))},s.saveFilter=function(){var t,o=s.editFilterId?n.partial(i.editFilter,s.editFilterId):i.addFilter;switch(s.newFilter.when.key){case a.CONDITIONS.FROM.JMAP_KEY:case a.CONDITIONS.TO.JMAP_KEY:case a.CONDITIONS.CC.JMAP_KEY:case a.CONDITIONS.RECIPIENT.JMAP_KEY:t=s.newFilter.stakeholders[0].email;break;case a.CONDITIONS.SUBJECT.JMAP_KEY:t=s.newFilter.subject}return o(s.newFilter.when.key,s.newFilter.name,t,{action:s.newFilter.then.key,mailboxId:s.newFilter.moveTo.id}).then((function(){e.go("unifiedinbox.configuration.filters")}))},s._initStakeholdersField=c,s._initMoveToField=d,s.JMAP_FILTER=a}n.$inject=["$state","_","inboxMailboxesService","inboxMailboxesFilterService","esnI18nService","userAPI","JMAP_FILTER"],e.module("linagora.esn.unifiedinbox").controller("inboxConfigurationFilterDefinitionController",n)}(angular)},E0jM:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").factory("inboxCustomRoleMailboxService",["_",function(e){var n=[];return{add:function(e){if(!e||!e.role)throw new Error("The mailbox must contain a role");n.push(e)},getAllRoles:function(){return n.map(e.property("role"))},getMailboxIcon:function(e){var t=n.find((function(n){return n.role===e}));return t&&t.icon}}}])}(angular)},Edxa:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").config(["dynamicDirectiveServiceProvider","$mdIconProvider",function(e,n){var t=new e.DynamicDirective(!0,"application-menu-inbox",{priority:45}),i=new e.DynamicDirective(!0,"attachment-download-action");e.addInjection("esn-application-menu",t),e.addInjection("attachments-action-list",i),n.defaultIconSet("images/mdi/mdi.svg",24)}])}(angular)},H4Be:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxSpecialMailboxes",["_","esnI18nService",function(e,n){var t=[];return{list:function(){return e.each(t,i)},get:function(n){return e.find(t,{id:n})},add:function(e){e.role=e.role||{},e.qualifiedName=e.name,e.unreadMessages=0,t.push(e)}};function i(e){return e.nameTranslated||(e.name=n.translate(e.name).toString(),e.qualifiedName=e.name,e.nameTranslated=!0),e}}])}()},HSVf:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").run(["jmapDraft","inboxMakeSelectable","_",function(e,n,t){function i(n){Object.defineProperty(e.Thread.prototype,n,{configurable:!0,get:function(){return t.any(this.emails,n)},set:function(e){this.emails.forEach((function(t){t[n]=e}))}})}function o(n,t){Object.defineProperty(e.Thread.prototype,n,{configurable:!0,get:function(){return this.lastEmail&&this.lastEmail[n]||t}})}Object.defineProperties(e.Thread.prototype,{mailboxIds:{configurable:!0,get:function(){return t(this.emails).pluck("mailboxIds").flatten().uniq().value()}},lastEmail:{configurable:!0,get:function(){return t.last(this.emails)}}}),o("subject",""),o("date"),o("hasAttachment",!1),i("isUnread"),i("isFlagged"),n(e.Thread.prototype)}])}()},HcpP:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").run(["inboxSpecialMailboxes","INBOX_ALL_MAIL_MAILBOX",function(e,n){e.add(n)}])}()},Hrwg:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxVacationBanner",{templateUrl:"/unifiedinbox/app/components/banner/vacation-banner/vacation-banner.html",controller:"inboxVacationBannerController"})}()},HurS:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").factory("inboxMailboxesFilterService",["$q","$sanitize","_","esnI18nService","inboxMailboxesService","JMAP_FILTER","jmapDraft","asyncJmapAction","withJmapClient",function(n,t,i,o,r,a,s,u,l){var c=this;return c.filters=[],c.filtersIds={},r.assignMailboxesList(c),{addFilter:function(e,n,t,i){var o=m(e,n,t,i);return f([].concat(c.filters,[o])).then((function(){return c.filters.push(o),c.filtersIds[o.id]=o,c.filters})).catch((function(){}))},deleteFilter:function(e){var n=i.filter(c.filters,(function(n){return String(n.id)!==String(e)}));if(n.length===c.filters.length)return!1;return f(n).then((function(){return c.filters=n,delete c.filtersIds[e],c.filters})).catch((function(){}))},editFilter:function(n,t,o,r,a){var s=i.findIndex(c.filters,{id:n});if(s<0)return!1;var u=m(t,o,r,a),l=e.copy(c.filters);return u.id=c.filters[s].id,l[s]=u,f(l).then((function(){return c.filters[s]=u,c.filtersIds[u.id]=u,c.filters})).catch((function(){}))},getFilterSummary:function(e){return o.translate("If a message").toString()+" "+function(e){var n,i=a.CONDITIONS[a.CONDITIONS_MAPPING[e.condition.field]].HUMAN_REPRESENTATION;switch(e.condition.field){case a.CONDITIONS.FROM.JMAP_KEY:case a.CONDITIONS.TO.JMAP_KEY:case a.CONDITIONS.CC.JMAP_KEY:case a.CONDITIONS.RECIPIENT.JMAP_KEY:return n="&#65279;<b>"+t(e.condition.value)+"</b>&#65279;",o.translate(i,n).toString();case a.CONDITIONS.SUBJECT.JMAP_KEY:return n="&#65279;<b>"+(n=o.translate('"%s"',t(e.condition.value)).toString())+"</b>&#65279;",o.translate(i,n).toString()}return i}(e)+" "+o.translate("then").toString()+" "+function(e){var n=a.ACTIONS[a.ACTIONS_MAPPING[Object.keys(e.action)[0]]].HUMAN_REPRESENTATION;switch(Object.keys(e.action)[0]){case a.ACTIONS.MOVE_TO.JMAP_KEY:var r="",s=i.find(c.mailboxes,{id:e.action.appendIn.mailboxIds[0]});s&&(r="&#65279;<b>"+t(s.qualifiedName)+"</b>&#65279;"),n=o.translate(n,r).toString()}return n}(e)},getFilters:function(){return c.filters.length?n.when(c.filters):l((function(n){return n.getFilter().then((function(n){return d(n),e.copy(c.filters)}))}))},get filters(){return e.copy(c.filters)},set filters(e){var n;f(n=e).then((function(){return d(n),c.filters})).catch((function(){}))},get filtersIds(){return e.copy(c.filtersIds)}};function d(n){c.filters=e.copy(n),c.filtersIds={},i.forEach(n,(function(e){c.filtersIds[e.id]=e}))}function f(e){return u({success:"Filters set",failure:"Error setting filters"},(function(n){return n.setFilter(e)}))}function m(e,n,t,i){var o;switch(e){case a.CONDITIONS.FROM.JMAP_KEY:o=new s.FilterRule(null,n).when.from.value(t).comparator(s.FilterRule.Comparator.EXACTLY_EQUALS);break;case a.CONDITIONS.TO.JMAP_KEY:o=new s.FilterRule(null,n).when.to.value(t).comparator(s.FilterRule.Comparator.EXACTLY_EQUALS);break;case a.CONDITIONS.CC.JMAP_KEY:o=new s.FilterRule(null,n).when.cc.value(t).comparator(s.FilterRule.Comparator.EXACTLY_EQUALS);break;case a.CONDITIONS.RECIPIENT.JMAP_KEY:o=new s.FilterRule(null,n).when.recipient.value(t).comparator(s.FilterRule.Comparator.EXACTLY_EQUALS);break;case a.CONDITIONS.SUBJECT.JMAP_KEY:o=new s.FilterRule(null,n).when.subject.value(t).comparator(s.FilterRule.Comparator.CONTAINS)}switch(i.action){case a.ACTIONS.MOVE_TO.JMAP_KEY:o.then.moveTo.mailboxId(String(i.mailboxId))}return o.toJSONObject()}}])}(angular)},HwEM:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").run(["limitToFilter","jmapDraft","inboxMailboxesCache","_","INBOX_DISPLAY_NAME_SIZE",function(e,n,t,i,o){Object.defineProperties(n.Mailbox.prototype,{descendants:{configurable:!0,get:function(){return function(e){var n=[],o=[e],r=[];function a(e){n.push(e),-1===r.indexOf(e.id)&&o.push(e.id)}for(;o.length;){var s=o.shift(),u=i.filter(t,{parentId:s});r.push(s),u.forEach(a)}return i.uniq(n)}(this.id)}},displayName:{configurable:!0,get:function(){var n=e(this.name,o);return this.name&&this.name.length>o&&(n+="â€¦"),n}}})}])}()},I48O:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").constant("INBOX_SHORTCUTS_CATEGORY",{id:"linagora.esn.unifiedinbox",name:"Unified Inbox",moduleDetector:/unifiedinbox/,shortcuts:{OPEN_COMPOSER:{combo:"c",description:"Compose new email"}}}).constant("INBOX_SHORTCUTS_NAVIGATION_CATEGORY",{id:"linagora.esn.unifiedinbox.navigation",name:"Navigation",shortcuts:{VIEW_NEXT_EMAIL:{combo:"right",description:"View next email"},VIEW_PREVIOUS_EMAIL:{combo:"left",description:"View previous email"}}}).constant("INBOX_SHORTCUTS_SELECTION_CATEGORY",{id:"linagora.esn.unifiedinbox.selection",name:"Selection",shortcuts:{SELECT_MULTIPLE_EMAILS:{combo:"<shift> + <click>",description:"Select multiple emails"}}}).constant("INBOX_SHORTCUTS_ACTIONS_CATEGORY",{id:"linagora.esn.unifiedinbox.actions",name:"Actions",shortcuts:{REPLY_EMAIL:{combo:"r",description:"Reply"},REPLY_ALL_EMAIL:{combo:"a",description:"Reply all"},FORWARD_EMAIL:{combo:"f",description:"Forward"},DELETE_EMAIL:{combo:"del",description:"Move to trash"},SPAM_EMAIL:{combo:"j",description:"Mark as spam"},SEND_EMAIL:{combo:"mod+return",description:"Send email"}}})}(angular)},IXVk:function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r){return{type:r,icon:null,upload:function(n){var o=e.defer(),r=t.get(i),a=r.addFile(n.getFile());return a.defer.promise.then((function(e){n.blobId=e.response.blobId,n.url=e.response.url,o.resolve()}),o.reject,(function(e){o.notify(e.progress)})),r.start(),{cancel:a.cancel,promise:o.promise}},fileToAttachment:function(e,t){var i=new n.Attachment(e,"",{name:t.name,size:t.size,type:t.type||o});return i.attachmentType=r,i.getFile=function(){return t},i}}}n.$inject=["$q","jmapDraft","fileUploadService","attachmentUploadService","DEFAULT_FILE_TYPE","INBOX_ATTACHMENT_TYPE_JMAP"],e.module("linagora.esn.unifiedinbox").factory("inboxAttachmentJmap",n)}(angular)},IgyH:function(e,n){!function(){"use strict";function e(e,n,t,i,o,r,a,s,u){var l,c,d=this;function f(e){return r.getUsersByEmail(e).then((function(e){if(e.data&&e.data[0])return e.data[0]}))}d.usersShared=[],d.users=[],d.onUserAdded=function(e){if(!e)return;e.selectedShareeRight=d.defaultRole,d.usersShared=d.usersShared.concat(e),o.grantDefaultRole(d.mailbox,e.preferredEmail?e.preferredEmail:e.email),d.users=[]},d.onUserRemoved=function(e){if(!e)return;n.remove(d.usersShared,{_id:e._id}),o.revoke(d.mailbox,e.preferredEmail?e.preferredEmail:e.email)},d.onUserRoleChanged=function(e,n){if(!e&&!n)return;o.grant(e,d.mailbox,n)},d.onAddingUser=function(e){return!!e._id&&!d.usersShared.some((function(n){return e._id===n._id}))},d.addSharedUsers=function(){return i.shareMailbox(d.mailbox)},d.isOwner=function(){return d.owner&&d.owner._id&&d.sessionUser&&d.sessionUser._id&&d.owner._id===d.sessionUser._id},d.sessionUser=t.user,d.originalMailbox=e.mailbox,d.defaultRole=o.getDefaultRole(),d.delegationTypes={READ_AND_UPDATE:{value:u.READ_AND_UPDATE,name:u.READ_AND_UPDATE_LABEL_LONG},ORGANIZE:{value:u.ORGANIZE,name:u.ORGANIZE_LABEL_LONG}},d.mailbox=n.clone(d.originalMailbox),(l=d.mailbox.namespace.owner&&d.mailbox.namespace.owner!==t.user.preferredEmail?f(d.mailbox.namespace.owner):d.sessionUser,s.resolve(l)).then((function(e){e.displayName=a.displayNameOf(e),d.owner=e})),c=d.mailbox.sharedWith,n.isEmpty(c)||n.forOwn(c,(function(e,n){s.all([f(n),o.getRole(d.mailbox,n)]).then((function(e){var n=e[0],t=e[1];(n||t)&&n&&t&&(n.displayName=a.displayNameOf(n),n.selectedShareeRight=t,d.usersShared=d.usersShared.concat(n))}))}))}e.$inject=["$scope","_","session","inboxMailboxesService","inboxSharedMailboxesPermissionsService","userAPI","userUtils","$q","INBOX_MAILBOX_SHARING_ROLES"],angular.module("linagora.esn.unifiedinbox").controller("InboxMailboxSharedSettingsController",e)}()},JbyE:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSidebarUserQuota",{templateUrl:"/unifiedinbox/app/components/user-quota/user-quota.html",controller:"inboxSidebarUserQuotaController"})}()},KHHp:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxMessageBody",{templateUrl:"/unifiedinbox/app/components/message-body/message-body.html",bindings:{message:"<"}})}()},Kagd:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("inboxSharedMailboxesService",["$q","_","inboxConfig","esnUserConfigurationService","INBOX_MODULE_NAME","INBOX_HIDDEN_SHAREDMAILBOXES_CONFIG_KEY","INBOX_ROLE_NAMESPACE_TYPES","INBOX_MAILBOXES_NON_SHAREABLE","INBOX_DEFAULT_FOLDERS_SHARING_CONFIG","INBOX_FOLDERS_SHARING_CONFIG_KEY",function(e,n,t,i,o,r,a,s,u,l){var c,d=null;function f(){return c?e.when(c):t(r,{}).then((function(e){return c=e}))}function m(e){return c=e,i.set([{name:r,value:e}],o)}function p(t,i){if(!i)return e.reject("no mailboxes provided");i=angular.isArray(i)?i:[i];var o=n.filter(i,{isDisplayed:!1}),r=n.map(n.compact(n.pluck(o,"id")),String),a=n.compose(n.partialRight(n.map,n.constant(!0)),n.range,n.size),s=n.zipObject(r,a(r));return f().then((function(e){return t(e,s)}))}return{isShared:function(e){return!!(e&&e.namespace&&e.namespace.type)&&(e.namespace&&e.namespace.type&&e.namespace.type.toLowerCase()===a.shared)},getHiddenMaiboxesConfig:f,isEnabled:function(){return null===d?t(l,u).then((function(e){return d=e})):e.when(d)},hideNewMailboxes:p.bind(null,(function(t,i){var o=n.zipObject(n.filter(n.pairs(t),(function(e){return!!e[1]})));return n.isEmpty(i)?e.when({}):m(n.assign(o,i))})),setHiddenMailboxes:p.bind(null,(function(e,n){return m(n)})),isShareableMailbox:function(e){var t=e.role.value;return null===t||!n.contains(s,t.toLowerCase())}}}])}()},LgMB:function(e,n){!function(e){"use strict";function n(n){var t=this;t.$onInit=function(){t.userEmail=t.user.preferredEmail,n("isLocalCopyEnabled",!1).then((function(n){t.isLocalCopyEnabled=n,t.keepLocalCopy=t.forwardings.indexOf(t.userEmail)>-1,t.excludedEmails=e.copy(t.forwardings),t.excludedEmails.indexOf(t.userEmail)<0&&t.excludedEmails.push(t.userEmail)}))},t.onAddForwarding=function(){var e=t.newForwardings.map((function(e){return e.email}));t.forwardings=t.forwardings.concat(e),t.excludedEmails=t.excludedEmails.concat(e),t.newForwardings=[]},t.onRemoveForwarding=function(e){t.forwardings=t.forwardings.filter((function(n){return n!==e})),t.excludedEmails.splice(t.excludedEmails.indexOf(e),1)},t.onKeepLocalCopyChange=function(){var e=t.forwardings.indexOf(t.userEmail);t.keepLocalCopy?t.forwardings.push(t.userEmail):t.forwardings.splice(e,1)},t.isNotUserEmail=function(e){return e!==t.userEmail}}n.$inject=["inboxConfig"],e.module("linagora.esn.unifiedinbox").controller("InboxForwardingsFormController",n)}(angular)},"Ll+L":function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxForwardings",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/forwardings/inbox-forwardings.html",controller:"InboxForwardingsController"})}(angular)},LxKL:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxListSidebarAttachmentButton",{templateUrl:"/unifiedinbox/app/components/sidebar/attachment-button/sidebar-attachment-button.html"})}()},MNGc:function(e,n){!function(e){"use strict";function n(e,n){var t=new e("inboxAttachmentProviderRegistry",{primaryKey:"type"});return t.getDefault=function(){return t.get(n)},t}n.$inject=["esnRegistry","INBOX_ATTACHMENT_TYPE_JMAP"],e.module("linagora.esn.unifiedinbox").factory("inboxAttachmentProviderRegistry",n)}(angular)},MWHR:function(e,n){!function(){"use strict";function e(e,n,t,i,o,r){var a=this;function s(){return i.getUserQuotaInfo().then((function(e){return e&&!t.isEmpty(e)?n.when((i=e,a=t.template("<%= usedStorageMsg %> / <%= maxStorageMsg %><%= percentRatioMsg %>"),s=i.maxStorage?o(i.maxStorage):r.translate("unlimited"),u=i.maxStorage?" ("+Number(i.storageRatio).toFixed(1)+"%)":"",a({usedStorageMsg:o(i.usedStorage),maxStorageMsg:s,percentRatioMsg:u}))):n.reject(new Error("No quota info found"));var i,a,s,u}))}a.$onInit=function(){s().then((function(e){a.quotaInfoLabel=e}))},a.getUserQuotaLabel=s}e.$inject=["$scope","$q","_","inboxUserQuotaService","bytesFilter","esnI18nService"],angular.module("linagora.esn.unifiedinbox").controller("inboxSidebarUserQuotaController",e)}()},Ma83:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxSearchForm",{templateUrl:"/unifiedinbox/app/search/form/search-form.html",controller:"inboxSearchFormController",controllerAs:"ctrl",bindings:{query:"="}})}(angular)},Mb4b:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").constant("INBOX_CONFIG_EVENTS",{DISABLE_FORWARDING_CANCELLED:"inbox:config:disableForwardingCancelled",DISABLE_LOCAL_COPY_CANCELLED:"inbox:config:disableLocalCopyCancelled"})}(angular)},MbdB:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("withJmapClient",["jmapClientProvider",function(e){return function(n){return e.get().then(n)}}])}()},MvW8:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxJmapHelper",["$q","jmapDraft","emailBodyService","withJmapClient","inboxIdentitiesService","_","JMAP_GET_MESSAGES_VIEW",function(e,n,t,i,o,r,a){return{getMessageById:function(e){return i((function(n){return n.getMessages({ids:[e],properties:a}).then(r.head)}))},toOutboundMessage:function(i,r){return e.when(r.identity||o.getDefaultIdentity()).then((function(e){var o={from:new n.EMailer({email:e.email,name:e.name}),replyTo:e.replyTo?[new n.EMailer({email:e.replyTo})]:null,subject:r.subject,to:s(r.to),cc:s(r.cc),bcc:s(r.bcc),headers:r.headers},a=r.htmlBody?"htmlBody":t.bodyProperty;return o[a]=r[a],r.attachments&&(o.attachments=(r.attachments||[]).filter((function(e){return e.blobId}))),new n.OutboundMessage(i,o)}))}};function s(e){return(e||[]).map((function(e){return new n.EMailer({name:e.name,email:e.email})}))}}])}()},NvQQ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxReadReceiptController",["inboxJmapItemService","emailSendingService",function(e,n){var t=this;t.$onInit=function(){t.readReceiptRequest=n.getReadReceiptRequest(t.message)},t.ackReceipt=function(){t.hide=!0,e.ackReceipt(t.message).catch((function(){t.hide=!1}))},t.hide=!1}])}()},O7Xo:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposerMobile",{templateUrl:"/unifiedinbox/app/components/composer/mobile/composer-mobile.html",controller:"inboxComposerMobileController"})}()},OEIk:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxRefreshButton",{templateUrl:"/unifiedinbox/app/components/list/refresh-button/refresh-button.html",bindings:{refresh:"&",loading:"<"}})}(angular)},Onhv:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxListSidebarAttachment",{templateUrl:"/unifiedinbox/app/components/sidebar/attachment/sidebar-attachment.html",controllerAs:"ctrl",controller:"inboxListSidebarAttachmentController"})}()},"P/4S":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposerAttachments",{templateUrl:"/unifiedinbox/app/components/composer/attachments/composer-attachments.html",controller:"inboxComposerAttachmentsController",bindings:{message:"<",upload:"&",removeAttachment:"&"}})}()},P1FX:function(e,n){!function(e){"use strict";function n(e){var n=new e.DynamicDirective(!0,"inbox-identities-tab",{attributes:[{name:"ng-if",value:"$ctrl.canEdit"}]});e.addInjection("profile-tabs",n)}n.$inject=["dynamicDirectiveService"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},P7VL:function(e,n){!function(e){"use strict";function n(e,n){e.add(n)}n.$inject=["searchProviders","inboxSearchResultsProvider"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},PVpr:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxEmailResolverService",["_","esnPeopleAPI","ESN_PEOPLE_FIELDS",function(e,n,t){return{resolve:function(i){return n.resolve(t.EMAIL_ADDRESS,i).catch(e.constant(null))}}}])}()},PkBJ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxComposerBodyEditorTextController",["$timeout","$scope","$element","emailBodyService","elementScrollService","autosize","INBOX_SIGNATURE_SEPARATOR",function(e,n,t,i,o,r,a){var s=this;function u(){s.onBodyUpdate({$body:s.message.textBody})}function l(){e((function(){r.update(t.find(".compose-body"))}),0)}s.$onChanges=function(e){e.identity&&function(e,n){if(!e||!n&&s.message.isDraft)return;var t=s.message.textBody||"",i=new RegExp("^"+a,"m").exec(t),o=/^\x00/m.exec(t),r="";r=i?t.substring(0,i.index):o?t.substring(0,o.index):t;e.textSignature&&(r||(r+="\n\n"),r+=a+e.textSignature+"\n\n");o&&(r+=t.substring(o.index));s.message.textBody=r,l()}(e.identity.currentValue,!e.identity.previousValue)},s.editQuotedMail=function(){return i.quote(s.message,s.message.quoteTemplate).then((function(e){s.message.isQuoting=!0,s.message.textBody=e})).then(u).then(l)},s.onChange=u}])}()},Pnvo:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("newComposerService",["$state","inboxJmapHelper","boxOverlayOpener","deviceDetector","esnI18nService",function(e,n,t,i,o){return{open:s,openDraft:function(e,t){n.getMessageById(e).then((function(e){s(e,t)}))}};function r(n){e.go("unifiedinbox.compose",{email:n})}function a(e,n){t.open(angular.extend({},{id:e&&e.id,title:o.translate("New message").toString(),templateUrl:"/unifiedinbox/app/components/composer/boxed/composer-boxed.html",email:e},n))}function s(e,n){var t,o;t=r.bind(null,e),o=a.bind(null,e,n),i.isMobile()?t():o()}}])}()},PuUy:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxIdentityForm",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/identity/form/identity-form.html",bindings:{identity:"<",userId:"<"},controller:"inboxIdentityFormController"})}()},QEQK:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").run(["jmapDraft","inboxMakeSelectable","inboxMailboxesService","emailSendingService",function(e,n,t,i){Object.defineProperties(e.Message.prototype,{isUnread:{configurable:!0,get:function(){return this._isUnread},set:function(e){this._isUnread!==e&&(angular.isDefined(this._isUnread)&&t.flagIsUnreadChanged(this,e),this._isUnread=e)}},hasReplyAll:{enumerable:!0,configurable:!0,get:function(){return i.showReplyAllButton(this)}}}),n(e.Message.prototype)}])}()},Qe7P:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("INBOX_RESTRICTED_MAILBOXES",["outbox","drafts"]).factory("inboxMailboxesService",["$q","_","$state","$rootScope","withJmapClient","jmapDraft","asyncJmapAction","inboxSpecialMailboxes","inboxMailboxesCache","inboxSharedMailboxesService","esnI18nService","INBOX_EVENTS","MAILBOX_LEVEL_SEPARATOR","INBOX_RESTRICTED_MAILBOXES",function(e,n,t,i,o,r,a,s,u,l,c,d,f,m){var p=!1;return i.$on(d.DRAFT_DESTROYED,(function(e,n){return M(n)})),{filterSystemMailboxes:function(e){return n.reject(e,(function(e){return e.role.value}))},assignMailboxesList:function(e,n){return C(n).then(T(e,"mailboxes"))},assignMailbox:function(t,i,r){var a=s.get(t)||r&&I(t);if(a)return e.when(T(i,"mailbox")(a));return o((function(e){return e.getMailboxes({ids:[t]}).then(n.head).then(b).then(S).then(I.bind(null,t)).then(T(i,"mailbox"))}))},flagIsUnreadChanged:function(e,n){e&&angular.isDefined(n)&&v(e.mailboxIds,n?1:-1)},canMoveMessage:function(e,n){if(e.isDraft)return n&&n.role===r.MailboxRole.TRASH;if(e.mailboxIds.indexOf(n.id)>-1)return!1;if(!D(n.id))return!1;return e.mailboxIds.every((function(e){return N(e)}))},getMessageListFilter:function(t,i){if(i=i||{},!t)return U(r.MailboxRole.INBOX).then((function(e){return n.assign({},{inMailboxes:[e.id]},i)}));var o,a=s.get(t);if(a){if((o=a.filter)&&o.unprocessed)return e.all([P(o.notInMailboxes),P(o.inMailboxes),_()]).then((function(e){delete o.unprocessed;var t=n.map(e[2],"id");return o.notInMailboxes=e[0].concat(t),o.inMailboxes=e[1],o}))}else o=n.assign({},{inMailboxes:[t]},i);return e.when(o)},createMailbox:function(e,n){return a({success:c.translate("Folder created"),progessing:c.translate("Creating folder..."),failure:c.translate("Failed to create folder")},(function(n){return n.createMailbox(e.name,e.parentId)}),{onFailure:n}).then(S)},destroyMailbox:function(t){var o=n(t.descendants).map(n.property("id")).reverse().push(t.id).value();return a({success:c.translate("Folder removed"),progessing:c.translate("Removing folder..."),failure:c.translate("Failed to remove folder")},(function(n){return n.setMailboxes({destroy:o}).then((function(n){if(y(n.destroyed),i.$broadcast(d.PERSONAL_FOLDERS_UPDATED),n.destroyed.length!==o.length)return e.reject("Expected "+o.length+" successfull deletions, but got "+n.destroyed.length+".")}))}))},updateMailbox:function(e,n){return F(e,{name:n.name,parentId:n.parentId})},shareMailbox:function(e){return F(e,{sharedWith:e.sharedWith},{success:"Sharing settings updated",progressing:"Updating sharing settings...",failure:"Failed to update sharing settings"})},getUserInbox:function(){return C(n.partialRight(n.filter,(function(e){return e&&e.role===r.MailboxRole.INBOX&&!l.isShared(e)}))).then(n.head)},getMailboxWithRole:U,updateCountersWhenMovingMessage:M,emptyMailbox:function(e){var n=L(e);return u[n].unreadMessages=0,u[n].totalMessages=0,u[n]},markAllAsRead:function(e){var n=L(e);return u[n].unreadMessages=0,u[n]},sharedMailboxesList:_,updateSharedMailboxCache:function(){return o((function(e){return e.getMailboxes().then((function(e){return x(R(e))})).then((function(e){var i,o,r=R(u),a=(i=r,o=e,n.difference(n.map(i,"id"),n.map(o,"id")));n.isEmpty(a)||(y(a),!0===a.includes(t.params.context)&&t.go("unifiedinbox.inbox",{type:"",account:"",context:""},{location:"replace"})),S(e)})).then((function(){return i.$broadcast(d.SHARED_FOLDERS_UPDATED),R(u)}))}))},canTrashMessages:function(e){var n=w(e);if(n){if(n.role===r.MailboxRole.DRAFTS)return!0;if(n.role===r.MailboxRole.TRASH)return!1}return N(n)},canUnSpamMessages:function(e){var n=w(e);return!!n&&n.role===r.MailboxRole.SPAM},canMoveMessagesIntoMailbox:D,canMoveMessagesOutOfMailbox:N,updateUnreadDraftsCount:function(t,i){var o=n.find(u,{role:r.MailboxRole.DRAFTS}),a=t&&t===o.id;if(i=i||e.when(),a)return i();return e.when(M({isUnread:!0},o?[o.id]:[]))}};function g(e){return n.each(e,b)}function b(e){return e&&e.role&&e.role.value&&(e.name=c.translate(e.name).toString()),e}function h(e,t){return l.isShared(t)&&n.has(e,t.id)}function x(e){return l.getHiddenMaiboxesConfig().then((function(e){return h.bind(null,e)})).then((function(t){return n.forEach(e,(function(e){t(e)&&(e.isDisplayed=!1)}))}))}function v(e,n){if(!e||!e.length)return!0;e.forEach((function(e){var t=I(e);t&&(t.unreadMessages=Math.max(t.unreadMessages+n,0))}))}function E(e,n){if(!e||!e.length)return!0;e.forEach((function(e){var t=I(e);t&&(t.totalMessages=Math.max(t.totalMessages+n,0))}))}function S(e){return angular.isArray(e)||(e=[e]),e.forEach((function(e){var n=L(e.id);u[n]=e})),u.forEach((function(e,n,t){t[n]=function(e){e.level=1,e.qualifiedName=e.name;for(var n=I(e.parentId);n;)e.qualifiedName=n.name+f+e.qualifiedName,e.level++,n=I(n.parentId);return e}(e)})),i.$broadcast(d.PERSONAL_FOLDERS_UPDATED),u.sort(A)}function A(e,n){return e.sortOrder-n.sortOrder||(e.qualifiedName<n.qualifiedName?-1:1)}function I(e){return e&&n.find(u,{id:e})}function y(e){return angular.isArray(e)||(e=[e]),n.remove(u,(function(t){return n.indexOf(e,t.id)>-1}))}function T(e,n){return function(t){return e&&!e[n]&&(e[n]=t),t}}function _(){return C().then(R)}function R(e){return n.filter(e,l.isShared)}function C(t){return p?e.when(u).then(t||n.identity):o((function(e){return e.getMailboxes().then((function(e){return p=!0,e})).then(g).then(x).then(S).then(t||n.identity)}))}function M(e,n){e.isUnread&&(v(e.mailboxIds,-1),v(n,1)),E(e.mailboxIds,-1),E(n,1)}function O(e){return!(!e||!e.role)&&m.indexOf(e.role.value)>-1}function w(e){return e&&e.id?e:n.find(u,{id:e})}function N(e){var n=w(e);return!(n&&(O(n)||!n.mayRemoveItems))}function D(e){var n,t=w(e);return!(t&&(n=t.id,s.get(n)||O(t)||!t.mayAddItems))}function P(t){return t?e.all(t.map(r.MailboxRole.fromRole).map(U)).catch(n.constant([])).then((function(e){return n(e).filter(Boolean).map("id").value()})):e.when([])}function F(e,t,i){var o=i||{};return a({success:c.translate(o.success||"Folder updated"),progressing:c.translate(o.progressing||"Updating folder..."),failure:c.translate(o.failure||"Failed to update folder")},(function(n){return n.updateMailbox(e.id,t)})).then(n.assign.bind(null,e,t)).then(S)}function U(e){return C((function(t){return n.filter(t,{role:e})})).then(n.head)}function L(e){var t=n.findIndex(u,{id:e});return t>-1?t:u.length}}])}()},"R+Am":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxMakeSelectable",["$rootScope","INBOX_EVENTS",function(e,n){return function(t){return Object.defineProperties(t,{selectable:{value:!0,enumerable:!0,writable:!1},selected:{enumerable:!0,configurable:!0,get:function(){return!!this._selected},set:function(t){!!this._selected!==t&&(this._selected=t,e.$broadcast(n.ITEM_SELECTION_CHANGED,this))}}}),t}}])}()},R4B8:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxQuotaBanner",{templateUrl:"/unifiedinbox/app/components/banner/quota-banner/quota-banner.html",controller:"inboxQuotaBannerController"})}()},RTID:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxRequestReadReceiptsSubheader",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/read-receipt/request-receipts/subheader/request-receipts-subheader.html",bindings:{onSave:"&"}})}()},RVy9:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposerAttachmentsSelector",{templateUrl:"/unifiedinbox/app/components/composer/attachments-selector/composer-attachments-selector.html",bindings:{attachmentHolder:"="}})}()},Ra0Y:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxSharedMailboxesController",["inboxMailboxesService","inboxSharedMailboxesService","_",function(e,n,t){var i=this;i.$onInit=function(){e.sharedMailboxesList().then((function(e){var n=t.map(e,(function(e){return t.defaults(e,{isDisplayed:!0})}));i.mailboxes=t.cloneDeep(n)}))},i.onSave=function(){n.setHiddenMailboxes(i.mailboxes).then((function(){e.updateSharedMailboxCache()}))}}])}()},RbOY:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxIdentity",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/identity/identity.html",bindings:{identity:"<",canEdit:"<",user:"<"},controller:"inboxIdentityController"})}()},Rmve:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").run(["jmapClientProvider",function(e){return e.get()}])}(angular)},"Rr/l":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").run(["$window","dynamicDirectiveService",function(e,n){"registerProtocolHandler"in e.navigator&&n.addInjection("esn-preferences-general",new n.DynamicDirective(!0,"inbox-preferences-mailto"))}])}()},RvFt:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxIdentitiesService",["_","$q","session","esnConfig","inboxUsersIdentitiesClient",function(e,n,t,i,o){return{canEditIdentities:function(){return t.userIsDomainAdministrator()?n.when(!0):i("linagora.esn.unifiedinbox.features.identity",{allowMembersToManage:!1}).then((function(e){return e.allowMembersToManage}))},getAllIdentities:r,getDefaultIdentity:function(n){return r(n=n||t.user._id).then((function(n){return e.find(n,{default:!0})}))},storeIdentity:function(i,s){return r(s=s||t.user._id).then((function(t){return e.find(t,{uuid:i.uuid})?function(t,i,r){var s=e.find(t,{uuid:i.uuid}),u=t.indexOf(s);if(s.default&&!i.default)return n.reject(new Error("There must be one default identity"));if(!s.default&&i.default){a(t).default=!1}return t[u]=i,o.updateIdentities(r,t)}(t,i,s):function(e,n,t){if(n.default){a(e).default=!1}return e.push(n),o.updateIdentities(t,e)}(t,i,s)}))},removeIdentity:function(i,a){return r(a=a||t.user._id).then((function(t){var r=e.find(t,{uuid:i});return r?r.default?n.reject(new Error("Could not remove the default identity")):(e.remove(t,r),o.updateIdentities(a,t)):n.reject(new Error("Identity not found"))}))}};function r(e){return e=e||t.user._id,o.getIdentities(e)}function a(n){return e.find(n,{default:!0})}}])}()},RvdB:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("jmapClientProvider",["$q","inboxConfig","jmapDraft","dollarHttpTransport","dollarQPromiseProvider","generateJwtToken","inboxCustomRoleMailboxService",function(e,n,t,i,o,r,a){var s;return{get:function(){return s?e.when(s):e.all([r(),n("api"),n("downloadUrl")]).then((function(e){return s=new t.Client(i,o).withAPIUrl(e[1]).withDownloadUrl(e[2]).withAuthenticationToken("Bearer "+e[0]).withCustomMailboxRoles(a.getAllRoles())}))}}}])}()},T05Q:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxFiltersSubheader",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/filters/subheader/filters-subheader.html"})}()},UZXN:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxRequestReadReceiptsController",["_","inboxRequestReceiptsService",function(e,n){var t=this;t.$onInit=function(){n.getDefaultReceipts().then((function(e){t.isAlwaysSendingRequest=e.isRequestingReadReceiptsByDefault}))},t.onSave=function(){return n.setDefaultReceipts({isRequestingReadReceiptsByDefault:t.isAlwaysSendingRequest})},t.isAlwaysSendingRequest=!1,t.alwaysRequestReadReceipts=function(){t.isAlwaysSendingRequest=!0},t.neverRequestReadReceipts=function(){t.isAlwaysSendingRequest=!1}}])}()},Uta4:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSubheaderMarkAsReadButton",{templateUrl:"/unifiedinbox/app/components/subheader/mark-as-read-button/subheader-mark-as-read-button.html"})}()},"V+BJ":function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").constant("INBOX_MODULE_NAME","linagora.esn.unifiedinbox").constant("MAILBOX_ROLE_ICONS_MAPPING",{default:"mdi mdi-email",inbox:"mdi mdi-inbox-arrow-down",archive:"mdi mdi-archive",drafts:"mdi mdi-file-document",outbox:"mdi mdi-inbox-arrow-up",sent:"mdi mdi-send",trash:"mdi mdi-delete",spam:"mdi mdi-alert-decagram",templates:"mdi mdi-clipboard-text"}).constant("INBOX_AVATAR_SIZE",65).constant("INBOX_CACHE_TTL",36e5).constant("INBOX_AUTOCOMPLETE_LIMIT",20).constant("INBOX_AUTOCOMPLETE_OBJECT_TYPES",["user","contact","group","ldap"]).constant("INBOX_DISPLAY_NAME_SIZE",100).constant("MAILBOX_LEVEL_SEPARATOR"," / ").constant("JMAP_GET_MESSAGES_LIST",["id","blobId","threadId","headers","subject","from","to","cc","bcc","replyTo","preview","date","isUnread","isFlagged","isDraft","hasAttachment","mailboxIds","isAnswered","isForwarded"]).constant("JMAP_GET_MESSAGES_VIEW",["id","blobId","threadId","headers","subject","from","to","cc","bcc","replyTo","preview","textBody","htmlBody","date","isUnread","isFlagged","isDraft","hasAttachment","attachments","mailboxIds"]).constant("JMAP_GET_MESSAGES_ATTACHMENTS_LIST",["id","blobId","threadId","subject","date","hasAttachment","attachments","mailboxIds"]).constant("ATTACHMENTS_ATTRIBUTES",["blobId","isInline","name","size","type"]).constant("DEFAULT_MAX_SIZE_UPLOAD",20971520).constant("DRAFT_SAVING_DEBOUNCE_DELAY",1e3).constant("INBOX_DEFAULT_NUMBER_ITEMS_PER_PAGE_ON_BULK_READ_OPERATIONS",30).constant("INBOX_DEFAULT_NUMBER_ITEMS_PER_PAGE_ON_BULK_DELETE_OPERATIONS",30).constant("INBOX_DEFAULT_NUMBER_ITEMS_PER_PAGE_ON_BULK_UPDATE_OPERATIONS",30).constant("DEFAULT_VIEW","messages").constant("INBOX_MESSAGE_HEADERS",{READ_RECEIPT:"Disposition-Notification-To",REPLY_TO:"In-Reply-To",FORWARD:"X-Forwarded-Message-Id"}).constant("INBOX_SWIPE_DURATION",500).constant("PROVIDER_TYPES",{JMAP:"jmap",SOCIAL:"social",SEARCH:"search"}).constant("INBOX_EVENTS",{VACATION_STATUS:"inbox:vacationStatusUpdated",FILTER_CHANGED:"inbox:filterChanged",FILTER_SOCIAL_CHANGED:"inbox:filterSocialChanged",ITEM_SELECTION_CHANGED:"inbox:itemSelectionChanged",ITEM_FLAG_CHANGED:"inbox:itemFlagChanged",ITEM_MAILBOX_IDS_CHANGED:"inbox:itemMailboxIdsChanged",BADGE_LOADING_ACTIVATED:"inbox:badgeLoadingActivated",UNAVAILABLE_ACCOUNT_DETECTED:"inbox:unavailableAccountDetected",DRAFT_DESTROYED:"inbox:draftDestroyed",DRAFT_CREATED:"inbox:draftCreated",PERSONAL_FOLDERS_UPDATED:"inbox:personalFoldersUpdated",SHARED_FOLDERS_UPDATED:"inbox:sharedFoldersUpdated"}).constant("INBOX_SUMMERNOTE_OPTIONS",{focus:!1,airMode:!1,disableResizeEditor:!0,toolbar:[["style",["style"]],["color",["color"]],["font",["bold","italic","underline","strikethrough"]],["alignment",["paragraph","ul","ol"]]],keyMap:{pc:{"CTRL+ENTER":"",ENTER:"insertParagraph"},mac:{"CMD+ENTER":"",ENTER:"insertParagraph"}}}).constant("INBOX_CONTROLLER_LOADING_STATES",{LOADING:"LOADING",LOADED:"LOADED",ERROR:"ERROR"}).constant("INBOX_MODULE_METADATA",{id:"linagora.esn.unifiedinbox",title:"Unified Inbox",icon:"/unifiedinbox/images/inbox-icon.svg",homePage:"unifiedinbox",config:{template:"inbox-config-form",displayIn:{user:!1,domain:!0,platform:!0}},disableable:!0,isDisplayedByDefault:!0}).constant("INBOX_SIGNATURE_SEPARATOR","-- \n")}(angular)},VqdP:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxComposerAttachmentsController",["inboxAttachmentProviderRegistry",function(e){this.getAttachmentProviderIcon=function(n){var t=e.get(n.attachmentType);return t&&t.icon}}])}()},WfCr:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxListHeader",{templateUrl:"/unifiedinbox/app/components/list/header/list-header.html",bindings:{item:"<",filters:"<",refresh:"&",loading:"<"},controller:"inboxListHeaderController"})}()},X5Fm:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSubheaderDeleteButton",{templateUrl:"/unifiedinbox/app/components/subheader/delete-button/subheader-delete-button.html"})}()},XKQ6:function(e,n){!function(e){"use strict";function n(e,n){e.addSearchKeeper((function(e,t){return t.type===n.SEARCH&&("unifiedinbox.inbox"===e.name||"unifiedinbox.inbox.message"===e.name)}))}n.$inject=["esnSearchQueryService","PROVIDER_TYPES"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},XKdh:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxComposerMobileController",["$rootScope","$stateParams","esnPreviousPage","newComposerService",function(e,n,t,i){var o=this;o.$onInit=function(){o.message=n.email},o.hide=function(){t.back("unifiedinbox")},o.show=function(){i.open(o.message)}}])}()},"XW/p":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxIdentitiesSubheader",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/identities/subheader/identities-subheader.html"})}()},Xmid:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").constant("INBOX_SEARCH_LOCAL_PROVIDER","INBOX_SEARCH_LOCAL_PROVIDER")}(angular)},Z4qW:function(e,n){!function(e){"use strict";function n(e,n){e.add(n)}n.$inject=["inboxAttachmentProviderRegistry","inboxAttachmentJmap"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},ZMjP:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxListGroupToggleSelectionController",["inboxSelectionService","inboxFilteredList","_",function(e,n,t){function i(){return t.filter(n.list(),{selectable:!0})}function o(){return t.every(i(),{selected:!0})}this.toggleSelection=function(){var n=!o();i().forEach((function(t){e.toggleItemSelection(t,n)}))},this.hasSelectableItems=function(){return t.some(n.list(),{selectable:!0})},this.isSelected=o}])}()},ZOBe:function(e,n){!function(e){"use strict";function n(e,n){this.cancelBtnClick=function(){e.$broadcast(n.DISABLE_LOCAL_COPY_CANCELLED)}}n.$inject=["$rootScope","INBOX_CONFIG_EVENTS"],e.module("linagora.esn.unifiedinbox").controller("InboxConfigFormDisableLocalCopyController",n)}(angular)},ZYuZ:function(e,n){!function(e){"use strict";function n(e,n){e.add(n())}n.$inject=["inboxPlugins","inboxSearchPluginService"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},adBT:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxVacationBannerController",["$rootScope","inboxJmapItemService","INBOX_EVENTS",function(e,n,t){var i=this;function o(){n.getVacationActivated().then((function(e){i.vacationActivated=e}))}i.$onInit=function(){o()},i.disableVacation=function(){i.vacationActivated=!1,n.disableVacation().catch((function(){i.vacationActivated=!0}))},i.setVacationStatus=o,e.$on(t.VACATION_STATUS,o)}])}()},"b+6A":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposerIdentitySelector",{templateUrl:"/unifiedinbox/app/components/composer/identity-selector/composer-identity-selector.html",controller:"inboxComposerIdentitySelectorController",bindings:{identity:"<",onIdentityUpdate:"&"}})}()},b23R:function(e,n){!function(e){"use strict";function n(e,n,t,i){var o=this;o.$onInit=function(){o.getFilters(),e.$on("filter-bag.drop-model",(function(){t.filters=o.filtersList})),i.options(e,"filter-bag",{moves:function(e,n,t){return t.className.match(/.*dragger.*/)||t.parentElement.className.match(/.*dragger.*/)}})},o.getFilters=function(){return t.getFilters().then((function(e){o.filtersList=e}))},o.deleteFilter=function(e){return t.deleteFilter(e).then((function(e){o.filtersList=e}))},o.filtersList}n.$inject=["$scope","_","inboxMailboxesFilterService","dragulaService"],e.module("linagora.esn.unifiedinbox").controller("inboxConfigurationFiltersController",n)}(angular)},b7P1:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxFolderSettings",{templateUrl:"/unifiedinbox/app/components/sidebar/folder-settings/folder-settings.html",bindings:{mailbox:"=",isFolder:"<",isShared:"<",isSystem:"<"},controllerAs:"ctrl",controller:"inboxFolderSettingsController"})}()},"bF2/":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxFilters",["PROVIDER_TYPES",function(e){var n=[{id:"isUnread",displayName:"Unread",type:e.JMAP,isGlobal:!0},{id:"isFlagged",displayName:"Starred",type:e.JMAP,isGlobal:!0},{id:"hasAttachment",displayName:"With attachments",type:e.JMAP,isGlobal:!0}];return n.add=function(e){Array.prototype.push.apply(n,Array.isArray(e)?e:[])},n}])}()},bQvj:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxConfigurationFilterDefinition",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/filter-definition/configuration-filter-definition.html",controller:"inboxConfigurationFilterDefinitionController",bindings:{editFilterId:"@"}})}(angular)},bTq2:function(e,n){!function(){"use strict";function e(e){var n=[];return{registerPreComposingHook:function(e){if("function"!=typeof e)throw new TypeError("Hook must be a function");n.push(e)},preComposing:function(t){return e.all(n.map((function(e){return e(t)}))).then((function(){return t}))}}}e.$inject=["$q"],angular.module("linagora.esn.unifiedinbox").factory("inboxEmailComposingHookService",e)}()},bvNq:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxConfigForm",{templateUrl:"/unifiedinbox/app/components/config/inbox-config-form.html",controller:"InboxConfigFormController",bindings:{configurations:"<",mode:"@",availableModes:"<"},require:{adminModulesDisplayerController:"^adminModulesDisplayer"}})}(angular)},cdbx:function(e,n){!function(e){"use strict";function n(e,n){return{getIdentities:function(t){return e.one("users",t).all("identities").getList().then((function(e){return n.stripRestangular(e.data)}))},getValidEmails:function(n){return e.one("users",n).all("identities").all("validEmails").getList().then((function(e){return e.data}))},updateIdentities:function(t,i){return e.one("users",t).all("identities").customPUT(i).then((function(e){return n.stripRestangular(e.data)}))}}}n.$inject=["inboxRestangular","Restangular"],e.module("linagora.esn.unifiedinbox").factory("inboxUsersIdentitiesClient",n)}(angular)},dIHu:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxMessageBodyHtml",{templateUrl:"/unifiedinbox/app/components/message-body/html/message-body-html.html",controller:"inboxMessageBodyHtmlController",bindings:{message:"<"}})}()},dyjM:function(e,n){!function(){"use strict";function e(e,n){var t=this;function i(){t.onIdentityUpdate({$identity:t.identity})}t.$onInit=function(){n.getAllIdentities().then((function(n){t.identities=n.filter((function(e){return e.usable})),t.identity=t.identity||e.find(t.identities,{default:!0})||t.identities[0]})).then(i)},t.onIdentityChange=i,t.getIdentityLabel=function(e){return e.name+" <"+e.email+">"}}e.$inject=["_","inboxIdentitiesService"],angular.module("linagora.esn.unifiedinbox").controller("inboxComposerIdentitySelectorController",e)}()},dzZ9:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").run(["$q","inboxConfig","inboxProviders","inboxHostedMailMessagesProvider","inboxHostedMailThreadsProvider","DEFAULT_VIEW",function(e,n,t,i,o,r){e.all([n("view",r)]).then((function(e){var n=e[0];t.add("messages"===n?i:o)}))}]).run(["$rootScope",function(e){e.inbox={list:{isElementOpened:!1,infiniteScrollDisabled:!1},rightSidebar:{isVisible:!1}}}]).run(["esnScrollListenerService",function(e){e.bindTo(".inbox-infinite-list .md-virtual-repeat-scroller")}]).run(["inboxEmailSendingHookService","emailSendingService",function(e,n){e.registerPreSendingHook(n.handleInlineImageBeforeSending)}])}(angular)},eLcg:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxFilteringService",["$rootScope","inboxMailboxesService","inboxFilters","_","INBOX_EVENTS",function(e,n,t,i,o){var r={},a=null;return{getAvailableFilters:function(){return i.filter(t,(function(e){var n=r.types?i.contains(r.types,e.type):e.isGlobal;return n||(e.checked=!1),n}))},isFilteringActive:function(){return i.some(t,{checked:!0})||!!a},clearFilters:function(){t.forEach((function(e){e.checked=!1})),u(null)},setProviderFilters:function(n){r=n,a=null,e.$broadcast(o.FILTER_CHANGED)},getAllProviderFilters:function(){return{acceptedIds:l(i(t).filter({checked:!0,selectionById:!0}).map("id").value()),acceptedTypes:s(),acceptedAccounts:r.accounts,filterByType:i(t).groupBy("type").reduce((function(e,n,t){return e[t]=i.reduce(n,(function(e,n){return n.checked&&(e[n.id]=!0),e}),{}),e}),{}),context:r.context,quickFilter:a}},getQuickFilter:function(){return a},setQuickFilter:u};function s(){return r.types?r.types:l(i(t).filter({checked:!0}).map("type").uniq().value())}function u(n){a=n,e.$broadcast(o.FILTER_CHANGED)}function l(e){return e.length>0?e:null}}])}()},f5ji:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxForwardingsForm",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/forwardings/form/inbox-forwardings-form.html",controller:"InboxForwardingsFormController",bindings:{forwardings:"=",user:"<"}})}(angular)},fO1n:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").service("inboxRequestReceiptsService",["$q","_","inboxConfig","esnUserConfigurationService","INBOX_MODULE_NAME","INBOX_RECEIPTS_CONFIG_KEY",function(e,n,t,i,o,r){var a;return{getDefaultReceipts:s,setDefaultReceipts:function(e){return s().then((function(){return a=n.assign(a,e),i.set([{name:r,value:a}],o)}))}};function s(){return t(r,{}).then((function(e){return a=n.defaults(e,{isRequestingReadReceiptsByDefault:!1})}))}}])}()},fjLs:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox",["restangular","esn.router","angularMoment","esn.notification","esn.iframe-resizer-wrapper","esn.file","esn.box-overlay","esn.profile","esn.summernote-wrapper","esn.attendee","esn.fullscreen-edit-form","esn.scroll","op.dynamicDirective","esn.header","esn.offline-wrapper","esn.lodash-wrapper","esn.settings-overlay","esn.desktop-utils","esn.form.helper","esn.infinite-list","esn.url","esn.background","esn.aggregator","esn.provider","esn.dragndrop","esn.autolinker-wrapper","esn.configuration","esn.core","linagora.esn.graceperiod","ngAnimate","esn.escape-html","esn.cache","esn.search","esn.async-action","esn.user","esn.session","esn.attachment-list","esn.avatar","esn.highlight","esn.escape-html","esn.registry","material.components.virtualRepeat","esn.module-registry","esn.user-configuration","esn.ui","ng.deviceDetector","esn.datetime","esn.i18n","esn.http","esn.shortcuts","esn.promise","esn.people","material.components.button","material.components.menu","material.components.icon","material.components.menuBar","esn.attachments-selector","linagora.esn.james",angularDragula(e)])}(angular)},fkWO:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").constant("INBOX_IDENTITIES_EVENTS",{UPDATED:"inbox:identities:updated"})}(angular)},fmes:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").run(["inboxHostedMailAttachmentProvider","esnAttachmentListProviders","esnModuleRegistry","INBOX_MODULE_METADATA",function(e,n,t,i){n.add(e),t.add(i)}])},fxcb:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").controller("unifiedInboxController",["$timeout","$interval","$scope","$stateParams","$q","infiniteScrollHelperBuilder","inboxProviders","inboxSelectionService","infiniteListService","PageAggregatorService","_","sortByDateInDescendingOrder","inboxFilteringService","inboxAsyncHostedMailControllerHelper","esnPromiseService","inboxMailboxesService","inboxFilteredList","inboxJmapItemService","inboxUserQuotaService","inboxPlugins","inboxUnavailableAccountNotifier","ELEMENTS_PER_PAGE","inboxLocalSearchProvider","INBOX_CONTROLLER_LOADING_STATES","INBOX_EVENTS","INFINITE_LIST_POLLING_INTERVAL","PROVIDER_TYPES",function(e,n,t,i,o,r,a,s,u,l,c,d,f,m,p,g,b,h,x,v,E,S,A,I,y,T,_){var R=v.get(i.type);function C(){h.getVacationActivated().then((function(e){t.vacationActivated=e}))}function M(e){return e&&e.length>0?o.when(e):o.reject(new Error("No recent item found !"))}function O(){return t.infiniteScrollDisabled=!1,t.infiniteScrollCompleted=!1,(R&&R.type===_.SEARCH?o.when([A()]):a.getAll(f.getAllProviderFilters())).then((function(e){return new l("unifiedInboxControllerAggregator",e,{compare:d,results_per_page:S}).bidirectionalFetcher()})).then((function(n){t.loadNextItems=n,t.loadRecentItems=n.loadRecentItems,e(t.loadMoreElements,0)}))}!function(){if(T>0){var e=n((function(){t.refresh()}),T);t.$on("$destroy",(function(){n.cancel(e)}))}}(),s.unselectAllItems(),b.reset(),f.setProviderFilters({types:i.type?[i.type]:null,accounts:i.account?[i.account]:null,context:i.context}),t.filters=f.getAvailableFilters(),t.loadMoreElements=r(t,(function(){return t.loadNextItems()}),b.addAll),t.inboxList=b.list(),t.inboxListModel=b.asMdVirtualRepeatModel(t.loadMoreElements),t.loading=!1,R&&R.type===_.JMAP&&R.resolveContextRole(i.account,i.context).then((function(e){t.mailboxRole=e})),t.$on(y.FILTER_CHANGED,O),t.$on(y.DRAFT_CREATED,(function(e){var n=e.currentScope;g.updateUnreadDraftsCount(i.context,(function(){return p.retry(function(e){return function(){return e.loadRecentItems().then(M)}}(n),{maxRetry:10}).then(b.addAll)}))})),t.$on(y.UNAVAILABLE_ACCOUNT_DETECTED,function(){this.state=I.ERROR}.bind(this)),C(),x.getUserQuotaInfo().then((function(e){e.quotaLevel&&(t.quotaActivated=!0)})),t.$on(y.VACATION_STATUS,C),m(this,O,E),t.refresh=function(){return t.loading=!0,t.loadRecentItems().then(b.addAll).finally((function(){t.loading=!1}))}}]).controller("viewEmailController",["$scope","$state","$stateParams","esnShortcuts","inboxJmapItemService","inboxMailboxesService","inboxJmapHelper","inboxAsyncHostedMailControllerHelper","inboxUnavailableAccountNotifier","inboxFilteredList","INBOX_SHORTCUTS_NAVIGATION_CATEGORY","INBOX_SHORTCUTS_ACTIONS_CATEGORY","INBOX_EVENTS","INBOX_CONTROLLER_LOADING_STATES",function(e,n,t,i,o,r,a,s,u,l,c,d,f,m){var p=t.context,g=t.emailId;function b(n){var t=e.email;return p?n(p):!t||t.mailboxIds.every((function(e){return n(e)}))}function h(t){var i=e.email[t];if(i){var o=i();return n.go(".",{emailId:o.id,item:o},{location:"replace"})}}e.email=t.item?t.item:l.getById(g),e.$on(f.UNAVAILABLE_ACCOUNT_DETECTED,function(){this.state=m.ERROR}.bind(this)),s(this,(function(){return a.getMessageById(g).then((function(n){e.email?["isUnread","isFlagged","attachments","textBody","htmlBody"].forEach((function(t){e.email[t]=n[t]})):e.email=n,o.markAsRead(e.email)})).finally((function(){e.email.loaded=!0}))}),u),["markAsRead","markAsFlagged","unmarkAsFlagged"].forEach(function(n){this[n]=function(){o[n](e.email)}}.bind(this)),["markAsUnread","moveToTrash","moveToSpam","unSpam"].forEach(function(t){this[t]=function(){n.go("^"),o[t](e.email)}}.bind(this)),this.move=function(){n.go(".move",{item:e.email})},this.canTrashMessages=function(){return b(r.canTrashMessages)},this.canMoveMessagesOutOfMailbox=function(){return b(r.canMoveMessagesOutOfMailbox)},this.canMoveMessageToSpam=function(){return b(r.canMoveMessagesOutOfMailbox)},this.canUnSpamMessages=function(){return b(r.canUnSpamMessages)},this.next=function(){return h("next")},this.previous=function(){return h("previous")},i.use(c.shortcuts.VIEW_NEXT_EMAIL,this.next,e),i.use(c.shortcuts.VIEW_PREVIOUS_EMAIL,this.previous,e),i.use(d.shortcuts.DELETE_EMAIL,this.moveToTrash,e),i.use(d.shortcuts.SPAM_EMAIL,this.moveToSpam,e)}]).controller("viewThreadController",["$scope","$stateParams","$state","withJmapClient","inboxJmapItemService","_","JMAP_GET_MESSAGES_VIEW",function(e,n,t,i,o,r,a){e.thread=n.item,i((function(t){t.getThreads({ids:[n.threadId]}).then(r.head).then((function(n){return e.thread||(e.thread=n),n.getMessages({properties:a})})).then((function(e){return e.map((function(e){return e.loaded=!0,e}))})).then((function(n){e.thread.emails=n})).then((function(){e.thread.emails.forEach((function(e,n,t){e.isCollapsed=!(e.isUnread||n===t.length-1)}))})).then((function(){o.markAsRead(e.thread)}))})),["markAsRead","markAsFlagged","unmarkAsFlagged"].forEach(function(n){this[n]=function(){o[n](e.thread)}}.bind(this)),["markAsUnread","moveToTrash"].forEach(function(n){this[n]=function(){t.go("^"),o[n](e.thread)}}.bind(this)),this.move=function(){t.go(".move",{item:e.thread})}}]).controller("inboxMoveItemController",["$scope","$stateParams","inboxMailboxesService","inboxJmapItemService","esnPreviousPage","inboxSelectionService","inboxFilteredList",function(e,n,t,i,o,r,a){t.assignMailboxesList(e),this.moveTo=function(e){return o.back(),i.moveMultipleItems(n.selection?r.getSelectedItems():a.getById(n.item.id),e)}}]).controller("inboxConfigurationFolderController",["$scope","inboxMailboxesService",function(e,n){n.assignMailboxesList(e,n.filterSystemMailboxes)}]).controller("addFolderController",["$scope","inboxMailboxesService","rejectWithErrorNotification","$modal",function(e,n,t,i){n.assignMailboxesList(e),e.mailbox=e.mailbox?e.mailbox:{},e.addFolder=function(o){return e.mailbox.name?(o(),n.createMailbox(e.mailbox,{linkText:"Reopen",action:function(){i({templateUrl:"/unifiedinbox/views/folders/add/index.html",controller:"addFolderController",controllerAs:"ctrl",backdrop:"static",placement:"center",scope:e})}})):t("Please enter a valid folder name")}}]).controller("editFolderController",["$scope","inboxMailboxesService","_","rejectWithErrorNotification",function(e,n,t,i){var o;n.assignMailboxesList(e).then((function(n){o=t.find(n,{id:e.mailbox.id}),e.mailbox=t.clone(o)})),e.editFolder=function(t){return e.mailbox.name?(t(),n.updateMailbox(o,e.mailbox)):i("Please enter a valid folder name")}}]).controller("inboxDeleteFolderController",["_","$scope","$state","inboxMailboxesService","esnI18nService",function(e,n,t,i,o){var r=n.mailbox.descendants,a=r.length,s=a-3,u=[];if(u.push(n.mailbox.id),u=u.concat(r.map(e.property("id"))),a<1)n.message=o.translate("Folder %s and all the messages it contains will be deleted and you won't be able to recover them.",n.mailbox.displayName).toString();else{var l=r.slice(0,3).map(e.property("displayName")).join(", ");n.message=s<=0?o.translate("Folder %s (including folder %s) and all the messages it contains will be deleted and you won't be able to recover them.",n.mailbox.displayName,l).toString():1===s?o.translate("Folder %s (including folders %s and %s) and all the messages it contains will be deleted and you won't be able to recover them.",n.mailbox.displayName,l,r[3].displayName).toString():o.translate("Folder %s (including folders %s, %s and some others) and all the messages it contains will be deleted and you won't be able to recover them.",n.mailbox.displayName,l,s).toString()}this.deleteFolder=function(){return e.contains(u,t.params.context)&&t.go("unifiedinbox.inbox",{type:"",account:"",context:""},{location:"replace"}),i.destroyMailbox(n.mailbox)}}]).controller("inboxConfigurationVacationController",["$rootScope","$scope","$state","$stateParams","$q","moment","jmapDraft","withJmapClient","rejectWithErrorNotification","asyncJmapAction","esnPreviousPage","esnI18nDateFormatService","esnConfig","INBOX_EVENTS",function(e,n,t,i,o,r,a,s,u,l,c,d,f,m){var p=this;this.momentTimes={fromDate:{fixed:!1,default:{hour:0,minute:0,second:0}},toDate:{fixed:!1,default:{hour:23,minute:59,second:59}}},n.vacation=i.vacation,n.dateFormat=d.getDateFormat(),n.vacation||(n.vacation={},n.is24HourFormat={},s((function(e){o.all([f("core.datetime").then((function(e){return e.use24hourFormat})),e.getVacationResponse()]).then((function(e){n.is24HourFormat=e[0],n.vacation=e[1],n.vacation.isEnabled||n.vacation.textBody||(n.vacation.textBody=n.defaultTextBody)})).then((function(){n.vacation.fromDate?p.fixTime("fromDate"):n.vacation.fromDate=r(),p.updateDateAndTime("fromDate"),n.vacation.toDate&&(n.vacation.hasToDate=!0,p.fixTime("toDate"),p.updateDateAndTime("toDate"))})).then((function(){n.vacation.loadedSuccessfully=!0}))}))),this.updateDateAndTime=function(e){n.vacation[e]&&(n.vacation[e]=r(n.vacation[e]),p.momentTimes[e].fixed||n.vacation[e].set(p.momentTimes[e].default))},this.fixTime=function(e){!p.momentTimes[e].fixed&&(p.momentTimes[e].fixed=!0)},this.toDateIsInvalid=function(){return n.vacation.hasToDate&&n.vacation.toDate&&n.vacation.toDate.isBefore(n.vacation.fromDate)},this.enableVacation=function(e){n.vacation.isEnabled=e},this.updateVacation=function(){return function(){if(n.vacation.isEnabled){if(!n.vacation.fromDate)return u("Please enter a valid start date");if(p.toDateIsInvalid())return u("End date must be greater than start date")}return o.when()}().then((function(){return c.back("unifiedinbox"),n.vacation.hasToDate||(n.vacation.toDate=null),l({progressing:"Saving vacation settings...",success:"Vacation settings saved",failure:"Failed to save vacation settings"},(function(e){return e.setVacationResponse(new a.VacationResponse(e,n.vacation))}),{onFailure:{linkText:"Go Back",action:function(){t.go("unifiedinbox.configuration.vacation",{vacation:n.vacation})}}})})).then((function(){e.$broadcast(m.VACATION_STATUS)})).catch((function(e){return n.vacation.loadedSuccessfully=!1,o.reject(e)}))},n.$on(m.VACATION_STATUS,(function(){s((function(e){e.getVacationResponse().then((function(e){n.vacation.isEnabled=e.isEnabled}))}))}))}]).controller("recipientsFullscreenEditFormController",["$scope","$state","$stateParams",function(e,n,t){if(!t.recipientsType||!t.composition||!t.composition.email)return n.go("unifiedinbox.compose");e.recipientsType=t.recipientsType,e.recipients=t.composition.email[t.recipientsType],e.backToComposition=function(){n.go("^",{composition:t.composition},{location:"replace"})},e.goToRecipientsType=function(e){n.go(".",{recipientsType:e,composition:t.composition},{location:"replace"})}}]).controller("attachmentController",["navigateTo","asyncAction","esnI18nService",function(e,n,t){this.download=function(i){return n({progressing:"Please wait while your download is being prepared",success:"Your download has started",failure:t.translate("Unable to download attachment %s",i.name)},(function(){return i.getSignedDownloadUrl().then(e)}))}}]).controller("inboxSidebarEmailController",["_","$scope","$rootScope","$interval","inboxMailboxesService","inboxSpecialMailboxes","inboxAsyncHostedMailControllerHelper","inboxUnavailableAccountNotifier","session","inboxSharedMailboxesService","$filter","INFINITE_LIST_POLLING_INTERVAL","INBOX_EVENTS",function(e,n,t,i,o,r,a,s,u,l,c,d,f){function m(){n.mailboxes&&(n.displayPersonnalFolders=c("filter")(n.mailboxes,{role:{value:"!"},namespace:{type:"Personal"}}).length>0)}function p(){n.mailboxes&&(n.displayFoldersSharedWithMe=c("inboxFilterVisibleSharedMailboxes")(n.mailboxes).length>0&&n.isFoldersSharingEnabled)}!function(){if(d>0){var e=i((function(){o.updateSharedMailboxCache()}),d);n.$on("$destroy",(function(){i.cancel(e)}))}}(),n.specialMailboxes=r.list(),n.emailAddress=u.user.preferredEmail,n.displayMyFolders=m,n.displaySharedFolders=p,n.$onDestroy=function(){n.updateMyPersonnalsfolders(),n.updateSharedfolders()},n.updateMyPersonnalsfolders=t.$on(f.PERSONAL_FOLDERS_UPDATED,m),n.updateSharedfolders=t.$on(f.SHARED_FOLDERS_UPDATED,p),a(this,(function(){return o.assignMailboxesList(n)}),s).then((function(){m(),l.isEnabled().then((function(e){n.isFoldersSharingEnabled=e,p()}))}))}]).controller("resolveEmailerController",["$scope","$q",function(e,n){this.resolveAvatar=function(){return e.emailer?e.emailer.resolve():n.when({})},e.$watch("emailer",(function(e){e&&e.resolve&&e.resolve()}))}]).controller("inboxListSubheaderController",["$state","$stateParams","inboxSelectionService","inboxJmapItemService","_","inboxMailboxesService","inboxPlugins",function(e,n,t,i,o,r,a){var s=this,u=n.account,l=n.context,c=a.get(n.type);function d(e){var n=t.getSelectedItems();return l?e(l):!n||n.every((function(n){return n.mailboxIds.every((function(n){return e(n)}))}))}c?(c.resolveContextName(u,l).then((function(e){s.resolvedContextName=e})),c.contextSupportsAttachments(u,l).then((function(e){s.contextSupportsAttachments=e}))):s.contextSupportsAttachments=!0,s.isSelecting=t.isSelecting,s.getSelectedItems=t.getSelectedItems,s.unselectAllItems=t.unselectAllItems,["markAsUnread","markAsRead","unmarkAsFlagged","markAsFlagged","moveToTrash","moveToSpam","unSpam"].forEach((function(e){s[e]=function(){i[e](t.getSelectedItems()),t.unselectAllItems()}})),s.move=function(){e.go(".move",{selection:!0})},s.canTrashMessages=function(){return d(r.canTrashMessages)},s.canMoveMessagesOutOfMailbox=function(){return d(r.canMoveMessagesOutOfMailbox)},s.canMoveMessageToSpam=function(){return d(r.canMoveMessagesOutOfMailbox)},s.canUnSpamMessages=function(){return d(r.canUnSpamMessages)}}])},gBiR:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").factory("inboxMailtoParser",(function(){return function(n){var t={};if(n){var i=new URL(n),o=i.searchParams;t.to=e(i.pathname),t.subject=o.get("subject"),t.textBody=t.htmlBody=o.get("body"),t.cc=e(o.get("cc")),t.bcc=e(o.get("bcc"))}return t};function e(e){return e?e.split(/[,;]/).map((function(e){return{name:e,email:e}})):[]}}))}(angular)},gYBJ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxIdentities",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/identities/identities.html",controller:"inboxIdentitiesController",bindings:{user:"<"}})}()},geLP:function(e,n){!function(e){"use strict";function n(e,n,t,i){return function(o,r,a){n.removeMessagesFromProvider({id:i}),(a=a||{}).reload=!0,a.location="replace",r.type=t.SEARCH,r.context="",r.account="",e.go("unifiedinbox.inbox",r,a)}}n.$inject=["$state","inboxFilteredList","PROVIDER_TYPES","INBOX_SEARCH_LOCAL_PROVIDER"],e.module("linagora.esn.unifiedinbox").factory("inboxSearchResultsProviderSubmit",n)}(angular)},ghTf:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxComposerBodyEditorHtmlController",["$q","$scope","$element","$compile","$filter","_","INBOX_SUMMERNOTE_OPTIONS","INBOX_SIGNATURE_SEPARATOR",function(e,n,t,i,o,r,a,s){var u=this,l=!1;function c(e,n){if(l&&e&&(n||!u.message.isDraft)){var i=t.find(".note-editable"),r=i.find("> div.openpaas-signature"),a=i.find("> cite");e.htmlSignature?(r.length||(r=angular.element('<div class="openpaas-signature"></div>'),a.length?r.insertBefore(a.get(0)):r.appendTo(i)),r.html(s+o("sanitizeStylisedHtml")(e.htmlSignature)),u.onBodyUpdate({$body:t.find(".summernote").summernote("code")})):r.remove()}}u.$onChanges=function(e){e.identity&&c(e.identity.currentValue,!e.identity.previousValue)},u.onSummernoteInit=function(){l=!0,c(u.identity,!0),t.find(".note-toolbar a").attr("tabindex","-1"),t.find(".note-editable").after(i('<inbox-composer-attachments message="$ctrl.message" upload="$ctrl.upload({ $attachment: $attachment })" remove-attachment="$ctrl.removeAttachment({ $attachment: $attachment })" />')(n))},u.onSummernoteKeydown=function(e){!e.metaKey&&!e.ctrlKey||10!==e.keyCode&&13!==e.keyCode||u.send()},u.onSummernoteBlur=function(){u.onBodyUpdate({$body:t.find(".summernote").summernote("code")})},u.onImageUpload=function(t){for(var i=[],o={images:[],other:[]},r=t.length;r-- >0;)/image\/*./.test(t.item(r).type)?o.images.push(t.item(r)):o.other.push(t.item(r));if(i=i.concat(o.images.map((function(t){return function(n){return e((function(e,t){var i=new FileReader;i.onload=function(){e(i.result)},i.onerror=t,i.readAsDataURL(n)}))}(t).then((function(e){n.editor.summernote("insertImage",e)}))}))),"function"==typeof u.onAttachmentsUpload&&o.other.length){var a=u.onAttachmentsUpload({attachments:o.other}).catch((function(){}));i.push(a)}return e.all(i)},u.summernoteOptions=a}])}()},hk4e:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxListGroupToggleSelection",{templateUrl:"/unifiedinbox/app/components/list/group-toggle-selection/list-group-toggle-selection.html",controller:"inboxListGroupToggleSelectionController"})}()},hlIG:function(e,n){!function(e){"use strict";function n(e,n){return e.withConfig((function(e){e.setFullResponse(!0),e.setBaseUrl("/unifiedinbox/api/inbox"),e.setErrorInterceptor((function(e){return 401===e.status&&n.redirectToLogin(),!0}))}))}n.$inject=["Restangular","httpErrorHandler"],e.module("linagora.esn.unifiedinbox").factory("inboxRestangular",n)}(angular)},i2WX:function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r){var a=this;a.init=function(){a.userId=i,a.identity=t},a.onSaveBtnClick=function(){return n({progressing:"Saving identity...",success:"Identity saved",failure:"Could not save identity"},(function(){return o.storeIdentity(a.identity,i).then((function(n){e.$broadcast(r.UPDATED,n)}))}))}}n.$inject=["$rootScope","asyncAction","identity","userId","inboxIdentitiesService","INBOX_IDENTITIES_EVENTS"],e.module("linagora.esn.unifiedinbox").controller("inboxIdentityEditController",n)}(angular)},iAHR:function(e,n){!function(){"use strict";function e(e,n,t){var i=this;i.emptyTrash=function(e){e&&n.emptyMailbox(e)},i.markAllAsRead=function(e){n.markAllAsRead(e)},i.isShareableMailbox=function(e){return t.isShareableMailbox(e)},e.mailbox=i.mailbox,t.isEnabled().then((function(e){i.isFoldersSharingEnabled=e}))}e.$inject=["$scope","inboxJmapItemService","inboxSharedMailboxesService"],angular.module("linagora.esn.unifiedinbox").controller("inboxFolderSettingsController",e)}()},iPUv:function(e,n){!function(e){"use strict";function n(n,t,i){return{restrict:"A",scope:{attachmentUploadCallback:"&attachmentDragAndDropHandler"},link:function(o,r){var a=[[r[0],"dragover",l],[document,"dragenter",function(e){l(e),s.css({height:r.height()}),o.isHelpTextVisible=!0,u.push(e.target)}],[document,"dragleave",function(e){l(e),(u=n.without(u,e.target)).length||(o.isHelpTextVisible=!1)}],[document,"drop",function(e){l(e),u.length=0,o.isHelpTextVisible=!1}],[r[0],"dragover",function(e){l(e),o.helpText=i.translate("Drop files here").toString(),r.addClass("esn-dragzone-hover")}],[r[0],"dragleave",function(e){l(e),o.helpText=i.translate("Drag files here").toString(),r.removeClass("esn-dragzone-hover")}],[r[0],"drop",function(e){l(e);for(var n=[],t=e.dataTransfer.files.length;t-- >0;)n.push(e.dataTransfer.files.item(t));o.attachmentUploadCallback({attachments:n})}]];!function(){d("isHelpTextVisible",!1),d("helpText","Drag files here"),r.addClass("esn-dragzone");e.element(t('<div class="esn-dragzone-help-text" ng-show="isHelpTextVisible">{{ helpText }}</div>')(o)).appendTo(r),c("addEventListener"),o.$on("$destroy",n.partial(c,"removeEventListener"))}();var s=r.find(".esn-dragzone-help-text"),u=[];function l(e){e.preventDefault()}function c(e){a.forEach((function(n){var t=n[0],i=n[1],o=n[2];t[e](i,o)}))}function d(e,n){var t="_"+e;o[t]=n,Object.defineProperty(o,e,{get:function(){return o[t]},set:function(e){o[t]!==e&&(o[t]=e,o.$apply())}})}}}}n.$inject=["_","$compile","esnI18nService"],e.module("linagora.esn.unifiedinbox").directive("attachmentDragAndDropHandler",n)}(angular)},iyyT:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").filter("inboxItemDate",["esnDatetimeService",function(e){return function(n){return e.format(n,e.getHumanTimeGrouping(n).dateFormat)}}])}()},jCtF:function(e,n){!function(e){"use strict";function n(n,t,i,o,r,a,s){return function(){var u=Object.create(o);return u.id=s,u.templateUrl="/unifiedinbox/views/unified-inbox/elements/message.html",u.types=[a.SEARCH],u.options.itemMatches=function(){return t.when(!0)},u.buildFetchContext({query:i.buildFromState(n)}).then(r.bind(null,u),e.noop),u}}n.$inject=["$stateParams","$q","esnSearchQueryService","inboxSearchResultsProvider","toAggregatorSource","PROVIDER_TYPES","INBOX_SEARCH_LOCAL_PROVIDER"],e.module("linagora.esn.unifiedinbox").factory("inboxLocalSearchProvider",n)}(angular)},jDXc:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("INBOX_QUOTA_LEVEL_THRESHOLDS",{major:95,critical:80})}()},jQpN:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("INBOX_HIDDEN_SHAREDMAILBOXES_CONFIG_KEY","hiddenSharedMailboxes").constant("INBOX_ROLE_NAMESPACE_TYPES",{shared:"delegated",owned:"personal"}).constant("INBOX_MAILBOXES_NON_SHAREABLE",["drafts","outbox","sent","trash"]).constant("INBOX_DEFAULT_FOLDERS_SHARING_CONFIG",!1).constant("INBOX_FOLDERS_SHARING_CONFIG_KEY","features.foldersSharing")}()},jXrA:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxIdentityFormController",["_","$scope","esnI18nService","inboxUsersIdentitiesClient","INBOX_SUMMERNOTE_OPTIONS",function(e,n,t,i,o){var r=this,a=t.translate("None").toString();r.$onInit=function(){return r.status="loading",r.identity=r.identity||{},r.initiallyDefaultIdentity=r.identity.default,i.getValidEmails(r.userId).then((function(e){r.status="loaded",r.validEmails=e,r.identity.email=r.identity.email||e[0],r.validReplyToEmails=angular.copy(e),r.validReplyToEmails.unshift(a),r.selectedReplyToEmail=r.identity.replyTo||a})).catch((function(){r.status="error"}))},r.onFocus=function(){r.isSummernoteFocused=!0,n.$apply()},r.onBlur=function(){r.isSummernoteFocused=!1,n.$apply()},r.onReplyToChange=function(){r.identity.replyTo=r.selectedReplyToEmail===a?void 0:r.selectedReplyToEmail},r.summernoteOptions=o}])}()},jjVl:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").run(["jmapDraft","inboxEmailerResolver",function(e,n){e.EMailer.prototype.resolve=n}])}(angular)},jqKX:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxListHeaderController",["$scope","esnDatetimeService","inboxFilteringService","INBOX_EVENTS",function(e,n,t,i){var o=this;function r(){o.quickFilter=t.getQuickFilter()}o.$onInit=r,o.$onChanges=function(e){if(!e||!e.item)return;o.group=e.item.currentValue&&n.getHumanTimeGrouping(e.item.currentValue.date)},o.setQuickFilter=function(e){if(!e&&!o.quickFilter)return;t.setQuickFilter(o.quickFilter=e)},e.$on(i.FILTER_CHANGED,r)}])}()},kJSp:function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r){[i,o,r].forEach((function(e){e.parentId=t.id,e.moduleDetector=t.moduleDetector})),e.register(t),e.register(i),e.register(o),e.register(r),e.use(t.shortcuts.OPEN_COMPOSER,(function(){n.open({})}))}n.$inject=["esnShortcuts","newComposerService","INBOX_SHORTCUTS_CATEGORY","INBOX_SHORTCUTS_NAVIGATION_CATEGORY","INBOX_SHORTCUTS_ACTIONS_CATEGORY","INBOX_SHORTCUTS_SELECTION_CATEGORY"],e.module("linagora.esn.unifiedinbox").run(n)}(angular)},kcuL:function(e,n){!function(e){"use strict";function n(n,t,i,o,r,a){var s,u=this;function l(){u.forwardingConfigs.forwarding.value=!u.forwardingConfigs.forwarding.value,s.isLocalCopyEnabled.value&&(u.forwardingConfigs.isLocalCopyEnabled.value=!u.forwardingConfigs.isLocalCopyEnabled.value)}function c(){u.forwardingConfigs.isLocalCopyEnabled.value=!u.forwardingConfigs.isLocalCopyEnabled.value}function d(){var n={forwarding:u.forwardingConfigs.forwarding.value,isLocalCopyEnabled:u.forwardingConfigs.isLocalCopyEnabled.value};return r.updateForwardingConfigurations(t.domainId,n).then((function(){s=e.copy(u.forwardingConfigs)})).catch((function(n){return u.forwardingConfigs=e.copy(s),i.reject(n)}))}u.$onInit=function(){if(u.mode!==u.availableModes.domain)return;u.forwardingConfigs={forwarding:e.copy(u.configurations.forwarding),isLocalCopyEnabled:e.copy(u.configurations.isLocalCopyEnabled)},s=e.copy(u.forwardingConfigs),u.adminModulesDisplayerController.registerPostSaveHandler(d),n.$on(a.DISABLE_FORWARDING_CANCELLED,l),n.$on(a.DISABLE_LOCAL_COPY_CANCELLED,c)},u.onForwardingChange=function(){u.forwardingConfigs.isLocalCopyEnabled.value=u.forwardingConfigs.forwarding.value,s.forwarding.value&&!u.forwardingConfigs.forwarding.value&&o({templateUrl:"/unifiedinbox/app/components/config/disable-forwarding/inbox-config-form-disable-forwarding.html",backdrop:"static",placement:"center",controller:"InboxConfigFormDisableForwardingController",controllerAs:"$ctrl"})},u.onLocalCopyChange=function(){s.isLocalCopyEnabled.value&&!u.forwardingConfigs.isLocalCopyEnabled.value&&o({templateUrl:"/unifiedinbox/app/components/config/disable-local-copy/inbox-config-form-disable-local-copy.html",backdrop:"static",placement:"center",controller:"InboxConfigFormDisableLocalCopyController",controllerAs:"$ctrl"})}}n.$inject=["$scope","$stateParams","$q","$modal","inboxForwardingClient","INBOX_CONFIG_EVENTS"],e.module("linagora.esn.unifiedinbox").controller("InboxConfigFormController",n)}(angular)},kfBz:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxConfig",["esnConfig","INBOX_MODULE_NAME",function(e,n){return function(t,i){return e(n+"."+t,i)}}])}()},kghp:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSharedMailboxes",{templateUrl:"/unifiedinbox/app/components/shared-mailboxes/shared-mailboxes.html",controller:"inboxSharedMailboxesController"})}()},khNc:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").factory("backgroundAction",["asyncAction","inBackground",function(e,n){return function(t,i,o){return e(t,(function(){return n(i())}),o)}}]).factory("asyncJmapAction",["backgroundAction","withJmapClient",function(e,n){return function(t,i,o){return e(t,(function(){return n(i)}),o)}}]).factory("sendEmail",["_","$http","$q","inboxConfig","inBackground","jmapDraft","withJmapClient","inboxJmapHelper","inboxMailboxesService","httpConfigurer","inboxEmailSendingHookService",function(e,n,t,i,o,r,a,s,u,l,c){function d(e){return a((function(o){return t.all([i("isJmapSendingEnabled"),s.toOutboundMessage(o,e)]).then((function(e){var t=e[0],i=e[1];return t?function(e,n){return u.getMailboxWithRole(r.MailboxRole.OUTBOX).then((function(t){return e.send(n,t)}))}(o,i):function(e){return n.post(l.getUrl("/unifiedinbox/api/inbox/sendemail"),e)}(i)}))}))}return function(e){return o(function(e){return c.preSending(e).then(d).then(c.postSending)}(e))}}]).factory("emailSendingService",["$q","emailService","jmapDraft","_","session","emailBodyService","sendEmail","inboxJmapHelper","INBOX_ATTACHMENT_TYPE_JMAP","INBOX_MESSAGE_HEADERS",function(e,n,t,i,o,r,a,s,u,l){var c={reply:{subjectPrefix:"Re: ",recipients:h,referenceIdHeader:l.REPLY_TO},forward:{subjectPrefix:"Fwd: ",templateName:"forward",includeAttachments:!0,referenceIdHeader:l.FORWARD},replyAll:{subjectPrefix:"Re: ",recipients:b,referenceIdHeader:l.REPLY_TO}};return{emailsAreValid:function(e){if(!e)return!1;return[].concat(e.to||[],e.cc||[],e.bcc||[]).every((function(e){return n.isValidEmail(e.email)}))},removeDuplicateRecipients:function(e){var n=function(e){return function(n){return!i.find(e,{email:n.email})}};if(!e)return;e.to=e.to||[],e.cc=(e.cc||[]).filter(n(e.to)),e.bcc=(e.bcc||[]).filter(n(e.to)).filter(n(e.cc))},removeReadReceiptRequest:function(e){e.headers&&e.headers[l.READ_RECEIPT]&&delete e.headers[l.READ_RECEIPT]},addReadReceiptRequest:function(e){var n=p(o.user);e.headers=e.headers||{},e.headers[l.READ_RECEIPT]=n},getReadReceiptRequest:function(e,n){if(n=n||{},!e||!e.headers||!e.headers[l.READ_RECEIPT])return!1;var t=e.headers[l.READ_RECEIPT];return n.asCurrentUser?o.user.emails.indexOf(t)>-1:o.user.emails.indexOf(t)<0&&t},noRecipient:function(e){return 0===d(e)},sendEmail:a,prefixSubject:f,getReplyRecipients:h,getReplyAllRecipients:b,getFirstRecipient:m,getAllRecipientsExceptSender:function(e){var n=o.user;return[].concat(e.to||[],e.cc||[],e.bcc||[]).filter((function(e){return e.email!==p(n)}))},showReplyAllButton:function(e){var n=d(e);return n>1||1===n&&p(m(e))!==p(o.user)},createReplyAllEmailObject:v.bind(null,c.replyAll),createReplyEmailObject:v.bind(null,c.reply),createForwardEmailObject:v.bind(null,c.forward),countRecipients:d,handleInlineImageBeforeSending:function(e){if(!e.attachments||!e.attachments.length||!e.mappingsUrlAndCid)return e;return(e=angular.extend({},e)).mappingsUrlAndCid.forEach((function(n){e.htmlBody=e.htmlBody.replace(n.url,"cid:"+n.cid)})),delete e.mappingsUrlAndCid,e}};function d(e){return e?i.size(e.to)+i.size(e.cc)+i.size(e.bcc):0}function f(e,n){return e&&n?(-1===n.indexOf(" ",n.length-1)&&(n+=" "),e.slice(0,n.length)===n?e:n+e):e}function m(e){return i.head(e.to)||i.head(e.cc)||i.head(e.bcc)}function p(e){if(e)return e.email||e.preferredEmail}function g(e){var n=i.reject(e.replyTo,{email:t.EMailer.unknown().email});return n.length>0?n:[e.from]}function b(e,n){function t(e){return e.email!==p(n)}if(e&&n)return{to:i(e.to||[]).concat(g(e)).uniq("email").value().filter(t),cc:(e.cc||[]).filter(t),bcc:e.bcc||[]}}function h(e){if(e)return{to:g(e),cc:[],bcc:[]}}function x(e,n){if(n.headers&&e){var t=n.headers["Message-ID"],i=n.headers.References||"",o=i&&i.split(" ").map(Function.prototype.call,String.prototype.trim).filter(Boolean),r={References:[].concat(o,[t]).filter(Boolean).join(" ")};return r[e]=n.headers["Message-ID"],r}}function v(e,n,t){return s.getMessageById(n).then((function(n){var i=e.recipients?e.recipients(n,t):{},o={from:p(t),to:i.to||[],cc:i.cc||[],bcc:i.bcc||[],subject:f(n.subject,e.subjectPrefix),quoted:n,isQuoting:!1,quoteTemplate:e.templateName||"default",headers:x(e.referenceIdHeader,n)};return(e.includeAttachments?E:S)(n,o).then((function(){return!r.supportsRichtext()&&n.htmlBody?r.quote(o,e.templateName,!0).then((function(e){return o.quoted.htmlBody=e,o})):r.quote(o,e.templateName).then((function(e){return function(e,n){return r.supportsRichtext()?e.htmlBody=n:e.textBody=n,e.isQuoting=!0,e}(o,e)}))}))}))}function E(n,t){if(!n.attachments||!n.attachments.length)return e.when();var i=I(n.attachments),o=n.attachments.filter((function(e){return!e.isInline}));return t.attachments=[],o.length&&o.forEach((function(e){e.attachmentType=u,e.status="uploaded",t.attachments.push(e)})),i.length?A(t,i):e.when()}function S(n,t){if(!n.attachments||!n.attachments.length)return e.when();var i=I(n.attachments);return i.length?(t.attachments=[],A(t,i)):e.when()}function A(n,t){var o,r,a=(o=n.quoted.htmlBody,r=(new DOMParser).parseFromString(o,"text/html").getElementsByTagName("img"),[].map.call(r,(function(e){var n=e&&e.src&&e.src.match(/^cid:(\S+)/);return n&&n[1]})).filter(Boolean));return t.forEach((function(e){n.attachments.push(e)})),function(n,t){var o=[];return n.forEach((function(e){var n=i.find(t,(function(n){return n.cid===e}));n&&n.getSignedDownloadUrl&&o.push(n.getSignedDownloadUrl().then((function(e){return{url:e,cid:n.cid}})))})),o.length>0?e.all(o):e.when([])}(a,t).then((function(e){n.mappingsUrlAndCid=e,e.forEach((function(e){n.quoted.htmlBody=n.quoted.htmlBody.replace("cid:"+e.cid,e.url)}))}))}function I(e){return e.filter((function(e){return e.isInline}))}}]).factory("waitUntilMessageIsComplete",["$q","_",function(e,n){return function(t){return function(e){return 0===n.size(e.attachments)||n.every(e.attachments,(function(e){return"uploaded"===e.status||(!e.upload||!e.upload.promise)&&!e.status}))}(t)?e.when(t):e.all(t.attachments.map((function(n){return n.upload&&n.upload.promise||e.when()}))).then(n.constant(t))}}]).factory("inboxMailboxesCache",(function(){return[]})).factory("inboxCacheService",["Cache","inboxEmailResolverService","INBOX_CACHE_TTL",function(e,n,t){var i=new e({loader:n.resolve,ttl:t});return{resolveEmail:function(e){return i.get(e)}}}]).service("searchService",["_","attendeeService","INBOX_AUTOCOMPLETE_LIMIT","INBOX_AUTOCOMPLETE_OBJECT_TYPES",function(e,n,t,i){return{searchRecipients:function(o,r){return n.getAttendeeCandidates(o,t,i,r).then((function(n){return n.filter(e.property("email")).map((function(e){return e.name=e.name||e.displayName||e.email,e}))}),e.constant([]))}}}]).service("attachmentUploadService",["$q","$rootScope","inboxConfig","jmapClientProvider","inBackground","xhrWithUploadProgress",function(e,n,t,i,o,r){function a(e){return function(t){return n.$$phase?e(t):n.$apply((function(){e(t)}))}}return{uploadFile:function(n,s,u,l,c,d){return e.all([i.get(),t("uploadUrl")]).then((function(n){var t=n[0].authToken,i=n[1],l=e.defer(),c=$.ajax({type:"POST",headers:{Authorization:t},url:i,contentType:u,data:s,processData:!1,dataType:"json",success:a(l.resolve),error:function(e,n,t){a(l.reject)({xhr:e,status:n,error:t})},xhr:r(a(l.notify))});return d&&d.then(c.abort),o(l.promise)}))}}}]).factory("inboxSwipeHelper",["$timeout","$q","inboxConfig","INBOX_SWIPE_DURATION",function(e,n,t,i){return{createSwipeRightHandler:function(o,r){return function(){return function(t){return e(t.swipeClose,i,!1),n.when()}(o).then(t.bind(null,"swipeRightAction","markAsRead")).then((function(e){return r[e]()}))}}}}]).factory("inboxUnavailableAccountNotifier",["$rootScope","INBOX_EVENTS",function(e,n){return function(t){e.$broadcast(n.UNAVAILABLE_ACCOUNT_DETECTED,t)}}]).factory("inboxAsyncHostedMailControllerHelper",["$q","session","INBOX_CONTROLLER_LOADING_STATES",function(e,n,t){return function(i,o,r){return i.account={name:n.user.preferredEmail},i.load=function(){return i.state=t.LOADING,o().then((function(e){return i.state=t.LOADED,e}),(function(o){return i.state=t.ERROR,r&&r(n.user.preferredEmail),e.reject(o)}))},i.load()}}])},kndV:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxJmapProviderContextBuilder",["_","$q","inboxMailboxesService","inboxJmapProviderFilterBuilder","PROVIDER_TYPES",function(e,n,t,i,o){return function(r){return r.query&&!e.isEmpty(r.query.advanced)&&e.isObject(r.query.advanced)?(a=r.query.advanced,n.when(i(function(n){var t={hasAttachment:n.hasAttachment&&[!0]};return t=e.assign(t,function(n){var t={},i=function(n){return e.isString(n.email)};return e.isArray(n.to)&&(t.to=n.to.filter(i).map((function(e){return e.email.trim()}))),e.isArray(n.from)&&(t.from=n.from.filter(i).map((function(e){return e.email.trim()}))),t}(n)),t=e.assign(t,function(n){var t=["subject","contains","excluded","body"].filter((function(t){return n[t]&&e.isString(n[t])})).map((function(t){return{propName:t,keywords:e.compact(n[t].split(" ").map((function(e){return e.trim()})))}}));return e.zipObject(e.map(t,"propName"),e.map(t,"keywords"))}(n))}(a)))):r.query&&!e.isEmpty(r.query.text)&&e.isString(r.query.text)?n.when({text:r.query.text}):(s=r,t.getMessageListFilter(s.context).then((function(e){return angular.extend(e,s.filterByType[o.JMAP],{text:s.quickFilter})})));var a,s}}]).factory("inboxJmapProviderFilterBuilder",["_",function(e){return function(n){function t(n,t){return e.zipObject([n],[t])}var i=["to","from","subject","cc","bcc","body","hasAttachment","contains","excluded"].filter((function(t){return e.has(n,t)&&e.isArray(n[t])&&!e.isEmpty(n[t])})).map((function(i){return e.contains(["excluded","contains"],i)?function(i){return{operator:"excluded"===i?"NOT":"AND",conditions:n[i].map(e.partial(t,"text"))}}(i):function(i){return e.size(n[i])>1?{operator:"AND",conditions:n[i].map(e.partial(t,i))}:t(i,e.head(n[i]))}(i)})).reduce((function(e,n){return[].concat(e,[n])}),[]);return e.size(i)>1?{operator:"AND",conditions:i}:e.head(i)||{}}}]).factory("inboxProviders",["Providers",function(e){return new e}]).factory("inboxNewMessageProvider",["$q","withJmapClient","pagedJmapRequest","inboxJmapProviderContextBuilder","esnSearchProvider","sortByDateInDescendingOrder","inboxMailboxesService","_","JMAP_GET_MESSAGES_LIST","ELEMENTS_PER_REQUEST","PROVIDER_TYPES",function(e,n,t,i,o,r,a,s,u,l,c){return function(d,f){return new o({uid:"op.inbox.emails",type:c.JMAP,activeOn:["unifiedinbox"],name:"Emails",fetch:function(e){var i=t(o);return i.loadRecentItems=function(e){return o(0,e.date).then((n=e,function(e){return n?s.reject(e,{id:n.id}):e})).then((function(e){return e.forEach((function(e){e.isUnread&&a.flagIsUnreadChanged(e,!0)})),e}));var n},i;function o(t,i){return n((function(n){return n.getMessageList({filter:i?angular.extend({},e,{after:i}):e,sort:["date desc"],collapseThreads:!1,fetchMessages:!1,position:t,limit:l}).then((function(e){return 0===e.messageIds.length?[]:e.getMessages({properties:u})})).then((function(e){return e.sort(r)})).then((function(e){return f?e.map(f):e}))}))}},buildFetchContext:i,cleanQuery:function(e){return e&&e.advanced&&(s.isArray(e.advanced.from)&&s.isEmpty(e.advanced.from)&&delete e.advanced.from,s.isArray(e.advanced.to)&&s.isEmpty(e.advanced.to)&&delete e.advanced.to),e},itemMatches:function(n,t){return e((function(e,i){var o=t.context,r=n.mailboxIds,u=t.filterByType[c.JMAP];a.getMessageListFilter(o).then((function(t){if((s.isEmpty(t.notInMailboxes)||0===s.intersection(r,t.notInMailboxes).length)&&(s.isEmpty(t.inMailboxes)||s.intersection(r,t.inMailboxes).length>0)&&(!t.header||n.headers[t.header])&&(s.isEmpty(u)||s.find([n],u)))return e();i()}))}))},templateUrl:d,searchTemplateUrl:"/unifiedinbox/app/search/form/search-form-template.html",placeHolder:"Search in emails"})}}]).factory("inboxHostedMailMessagesProvider",["inboxNewMessageProvider","computeUniqueSetOfRecipients",function(e,n){return e("/unifiedinbox/views/unified-inbox/elements/message",n)}]).factory("inboxHostedMailAttachmentProvider",["withJmapClient","pagedJmapRequest","newProvider","ByDateElementGroupingTool","inboxFilteringService","inboxMailboxesService","inboxJmapProviderContextBuilder","JMAP_GET_MESSAGES_ATTACHMENTS_LIST","ELEMENTS_PER_REQUEST","PROVIDER_TYPES",function(e,n,t,i,o,r,a,s,u,l){return t({type:l.JMAP,name:"Attachments",fetch:function(t){return n((function(n){return e((function(e){return e.getMessageList({filter:angular.extend(t,{hasAttachment:!0}),sort:["date desc"],collapseThreads:!1,fetchMessages:!1,position:n,limit:u}).then((function(e){return e.getMessages({properties:s})}))}))}))},buildFetchContext:function(e){return e.id&&r.getMessageListFilter(e.id)||a(e)},templateUrl:"/unifiedinbox/views/components/sidebar/attachment/sidebar-attachment-item"})}]).factory("inboxHostedMailThreadsProvider",["$q","withJmapClient","pagedJmapRequest","_","inboxJmapProviderContextBuilder","newProvider","JMAP_GET_MESSAGES_LIST","ELEMENTS_PER_REQUEST","PROVIDER_TYPES",function(e,n,t,i,o,r,a,s,u){function l(e){var n=e[0];return e[1].forEach((function(e){i.find(n,{id:e.threadId}).emails=[e]})),n}return r({type:u.JMAP,name:"inboxHostedMailThreadsProvider",fetch:function(i){return t((function(t){return n((function(n){return n.getMessageList({filter:i,sort:["date desc"],collapseThreads:!0,fetchThreads:!1,fetchMessages:!1,position:t,limit:s}).then((function(n){return e.all([n.getThreads({fetchMessages:!1}),n.getMessages({properties:a})])})).then(l)}))}))},buildFetchContext:o,templateUrl:"/unifiedinbox/views/unified-inbox/elements/thread"})}]).factory("pagedJmapRequest",(function(){return function(e){var n=0;return function(){return e(n).then((function(e){return n+=e.length,e}))}}})).factory("computeUniqueSetOfRecipients",["_",function(e){return function(n){return n&&n.to&&n.cc&&n.bcc&&(n.emailRecipients=e.chain(e.union(n.to,n.cc,n.bcc)).uniq(!1,(function(e){return e.email})).value(),n.emailFirstRecipient=e.first(n.emailRecipients)),n}}])},l4q6:function(e,n){!function(e){"use strict";function n(e,n,t,i,o){var r=this;r.init=function(){r.userId=t,r.identity={}},r.onCreateBtnClick=function(){return n({progressing:"Creating identity...",success:"Identity created",failure:"Failed to create identity"},(function(){return i.storeIdentity(r.identity,t).then((function(n){e.$broadcast(o.UPDATED,n)}))}))}}n.$inject=["$rootScope","asyncAction","userId","inboxIdentitiesService","INBOX_IDENTITIES_EVENTS"],e.module("linagora.esn.unifiedinbox").controller("inboxIdentityCreateController",n)}(angular)},lQBM:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSubheaderMoreButton",{templateUrl:"/unifiedinbox/app/components/subheader/more-button/subheader-more-button.html"})}()},ltRY:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").config(["$stateProvider",function(e){function n(e){function n(e){return function(n){n.inbox.list.isElementOpened=e,e?n.inbox.list.infiniteScrollDisabled=e:n.$applyAsync((function(){n.inbox.list.infiniteScrollDisabled=!1}))}}return e.onEnter=n(!0),e.onExit=n(!1),e.params=e.params||{},e.params.item=void 0,e}function t(e,n,t){return e.resolve={modalHolder:function(){return{}}},e.onEnter=function(e,i){i.modal=e({templateUrl:n,controller:t,controllerAs:"ctrl",backdrop:"static",placement:"center"})},e.onExit=function(e){e.modal.hide()},e}function i(e,n){return n("enabled",!0).then((function(n){n||e.path("/")})).catch((function(){e.path("/")}))}i.$inject=["$location","inboxConfig"],e.state("unifiedinbox",{url:"/unifiedinbox",templateUrl:"/unifiedinbox/views/home",deepStateRedirect:{default:"unifiedinbox.inbox",fn:function(){return{state:"unifiedinbox.inbox"}}}}).state("unifiedinbox.compose",{url:"/compose",views:{"main@unifiedinbox":{template:"<inbox-composer-mobile />"}},params:{email:{}}}).state("unifiedinbox.configuration",{url:"/configuration",deepStateRedirect:{default:"unifiedinbox.configuration.vacation",fn:function(){return{state:"unifiedinbox.configuration.vacation"}}},views:{"main@unifiedinbox":{template:"<inbox-configuration />"}}}).state("unifiedinbox.configuration.vacation",{url:"/vacation",views:{"configuration@unifiedinbox.configuration":{templateUrl:"/unifiedinbox/views/configuration/vacation/index",controller:"inboxConfigurationVacationController as ctrl"}},params:{vacation:null}}).state("profile.details.identities",{url:"/identities",views:{"details@profile.details":{template:'<inbox-identities user="user" />'}}}).state("unifiedinbox.configuration.identities.add",{url:"/add",views:{"main@unifiedinbox":{template:"<inbox-identity-form />"}}}).state("unifiedinbox.configuration.identities.identity",{url:"/:identityId",views:{"main@unifiedinbox":{template:function(e){return'<inbox-identity-form identity-id="'+e.identityId+'" />'}}}}).state("unifiedinbox.configuration.shared",{url:"/shared",views:{"configuration@unifiedinbox.configuration":{template:"<inbox-shared-mailboxes />"}},resolve:{isFoldersSharingEnabled:["$location","inboxConfig",function(e,n){return n("foldersSharing",!1).then((function(n){n||e.path("/unifiedinbox/configuration")}))}]}}).state("unifiedinbox.configuration.readreceipts",{url:"/readreceipts",views:{"configuration@unifiedinbox.configuration":{template:"<inbox-request-read-receipts />"}}}).state("unifiedinbox.configuration.forwardings",{url:"/forwardings",views:{"configuration@unifiedinbox.configuration":{template:"<inbox-forwardings />"}},resolve:{isForwardingEnabled:["$location","inboxConfig",function(e,n){return n("forwarding",!1).then((function(n){n||e.path("/unifiedinbox/configuration")}))}]}}).state("unifiedinbox.configuration.filters",{url:"/filters",views:{"configuration@unifiedinbox.configuration":{template:"<inbox-configuration-filters />"}}}).state("unifiedinbox.configuration.filters.new",{url:"/new",views:{"configuration@unifiedinbox.configuration":{template:"<inbox-configuration-filter-definition />"}}}).state("unifiedinbox.configuration.filters.edit",{url:"/edit/{id}",views:{"configuration@unifiedinbox.configuration":{templateProvider:["$timeout","$stateParams",function(e,n){return e((function(){return'<inbox-configuration-filter-definition edit-filter-id="'+n.id+'" />'}),0)}]}}}).state("unifiedinbox.inbox",{url:"/inbox?type&account&context&q&{a:json}",params:{q:{value:"",squash:!0},a:{value:{},squash:!0}},resolve:{isModuleActive:i,cleanState:["$stateParams","PROVIDER_TYPES",function(e,n){e.type!==n.SEARCH&&(e.q="",e.a={})}]},views:{"main@unifiedinbox":{controller:"unifiedInboxController as ctrl",templateUrl:"/unifiedinbox/views/unified-inbox/index"}}}).state("unifiedinbox.inbox.attachments",function(e){function n(e){return function(n){n.inbox.rightSidebar.isVisible=e}}return e.onEnter=n(!0),e.onExit=n(!1),e}({url:"/attachments",views:{"sidebar@unifiedinbox.inbox":{template:"<inbox-list-sidebar-attachment />"}}})).state("unifiedinbox.inbox.attachments.message",n({url:"/:emailId",views:{"preview-pane@unifiedinbox.inbox":{templateUrl:"/unifiedinbox/views/email/view/index",controller:"viewEmailController as ctrl"}}})).state("unifiedinbox.inbox.move",t({url:"/move",params:{item:void 0,selection:!1}},"/unifiedinbox/views/email/view/move/index","inboxMoveItemController")).state("unifiedinbox.inbox.message",n({url:"/:emailId",views:{"preview-pane@unifiedinbox.inbox":{templateUrl:"/unifiedinbox/views/email/view/index",controller:"viewEmailController as ctrl"}}})).state("unifiedinbox.inbox.message.move",t({url:"/move"},"/unifiedinbox/views/email/view/move/index","inboxMoveItemController"))}])}(angular)},mTo6:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxPreferencesMailto",{templateUrl:"/unifiedinbox/app/components/preferences/general/inbox-preferences-mailto.html",controller:"inboxPreferencesMailtoController",require:{parent:"^controlcenterGeneral"}})}()},mlVu:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxMailboxSharedSettingsUser",{bindings:{user:"<",onUserRemoved:"=?",delegationTypes:"=",onUserRoleChanged:"=?",isOwner:"="},controllerAs:"ctrl",templateUrl:"/unifiedinbox/app/components/mailbox-shared-settings/user/mailbox-shared-settings-user.html"})}()},nBjT:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("emailBodyService",["$interpolate","$templateRequest","deviceDetector",function(e,n,t){return{bodyProperty:o()?"htmlBody":"textBody",quote:function(e,n,t){n||(n="default");return i(e,"/unifiedinbox/views/partials/quotes/"+n+(t||o()?".html":"Text.html"),t||o())},quoteOriginalEmail:function(e){return i(e,"/unifiedinbox/views/partials/quotes/original.html",!0)},supportsRichtext:o};function i(t,i,o){return n(i).then((function(n){return function(n,t){return e(t)({email:n,marker:"\0"})}(t,o?n:(i=n,angular.element("<div />").html(i.replace(/<br\/>/g,"\n")).text()));var i}))}function o(){return!t.isMobile()}}])}()},nlxQ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSubheaderMarkAsUnreadButton",{templateUrl:"/unifiedinbox/app/components/subheader/mark-as-unread-button/subheader-mark-as-unread-button.html"})}()},oiXd:function(e,n){!function(e){"use strict";function n(e,n){this.cancelBtnClick=function(){e.$broadcast(n.DISABLE_FORWARDING_CANCELLED)}}n.$inject=["$rootScope","INBOX_CONFIG_EVENTS"],e.module("linagora.esn.unifiedinbox").controller("InboxConfigFormDisableForwardingController",n)}(angular)},p4Rh:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxConfigurationFilterCard",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/filters/filter-card/configuration-filter-card.html",controller:"inboxConfigurationFilterCardController",bindings:{filter:"<",deleteFilter:"<"}})}()},p4hc:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxMailboxSharedSettingsOwner",{bindings:{owner:"<"},controllerAs:"ctrl",templateUrl:"/unifiedinbox/app/components/mailbox-shared-settings/owner/mailbox-shared-settings-owner.html"})}()},pZJQ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").filter("inboxQuote",(function(){return function(e){return e?e.trim().replace(/(^|\n)/g,"$1> "):e}}))}()},qJN7:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("INBOX_ALL_MAIL_MAILBOX",{id:"all",name:"All Mail",role:{value:"all"},icon:"mdi mdi-folder-outline",filter:{unprocessed:!0,notInMailboxes:["archive","drafts","outbox","sent","trash","spam","templates"]}})}()},"qZP/":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").run(["$q","inboxMailboxesService","inboxPlugins","_","PROVIDER_TYPES",function(e,n,t,i,o){t.add({type:o.JMAP,contextSupportsAttachments:i.constant(e.when(!0)),resolveContextName:function(e,t){return n.assignMailbox(t,{},!0).then(i.property("name"))},resolveContextRole:function(e,t){return n.assignMailbox(t,{},!0).then(i.property("role"))},getEmptyContextTemplateUrl:function(e,t){return n.assignMailbox(t,{},!0).then((function(e){return!e||e.role.value?"/unifiedinbox/app/services/plugins/jmap/jmap-empty-message.html":"/unifiedinbox/app/services/plugins/jmap/jmap-empty-message-custom-folder.html"}))}})}])}()},qyDE:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("inboxPlugins",["esnRegistry",function(e){return e("inboxContextHelpers",{primaryKey:"type"})}])}()},qzXX:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").directive("applicationMenuInbox",["applicationMenuTemplateBuilder","INBOX_MODULE_METADATA",function(e,n){return{retrict:"E",replace:!0,template:e("/#/unifiedinbox",{url:n.icon},"Inbox","core.modules.linagora.esn.unifiedinbox.enabled",n.isDisplayedByDefault)}}]).directive("newComposer",["$timeout","newComposerService",function(e,n){return{restrict:"A",link:function(e,t){t.click((function(){n.open({})}))}}}]).directive("opInboxCompose",["$parse","newComposerService","_",function(e,n,t){return{restrict:"A",link:function(i,o,r){function a(){return t.contains(r.ngHref,"mailto:")?r.ngHref.replace(/^mailto:/,"").split(","):r.opInboxCompose&&"op-inbox-compose"!==r.opInboxCompose?[r.opInboxCompose]:void 0}o.on("click",(function(t){var o=a();if(o||r.opInboxComposeUsers){var s;if(t.preventDefault(),t.stopPropagation(),r.opInboxComposeUsers)s=e(r.opInboxComposeUsers)(i).map((function(e){var n={name:e.name||e.displayName||e.displayName()||e.firstname+" "+e.lastname||e.preferredEmail,email:e.email||e.preferredEmail};return Object.assign(e,n)}));else s=o.map((function(e){return{email:e,name:r.opInboxComposeDisplayName||e}}));n.open({to:s})}}))}}}]).directive("inboxFab",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/inbox-fab.html",link:function(e,n){function t(){return n.children("button").first()}e.$on("box-overlay:no-space-left-on-screen",(function(){t().removeClass("btn-accent"),e.isDisabled=!0})),e.$on("box-overlay:space-left-on-screen",(function(){t().addClass("btn-accent"),e.isDisabled=!1}))}}})).directive("mailboxDisplay",["_","$rootScope","inboxCustomRoleMailboxService","inboxMailboxesService","inboxJmapItemService","MAILBOX_ROLE_ICONS_MAPPING","INBOX_EVENTS",function(e,n,t,i,o,r,a){return{restrict:"E",replace:!0,scope:{mailbox:"=",hideBadge:"@",hideAside:"&",isSpecial:"=?",isSystem:"=?",isFolder:"=?",isShared:"=?"},templateUrl:"/unifiedinbox/views/sidebar/email/menu-item.html",link:function(s){s.mailboxIcons=s.mailbox.icon||t.getMailboxIcon(s.mailbox.role.value)||r[s.mailbox.role.value||"default"],n.$on(a.BADGE_LOADING_ACTIVATED,(function(e,n){s.badgeLoadingActivated=n})),s.onDrop=function(e){return o.moveMultipleItems(e,s.mailbox)},s.isDropZone=function(n){return e.all(n,(function(e){return i.canMoveMessage(e,s.mailbox)}))}}}}]).directive("inboxEmailer",["session",function(e){return{restrict:"E",replace:!0,controller:"resolveEmailerController",scope:{emailer:"=",hideEmail:"=?",highlight:"@?"},templateUrl:"/unifiedinbox/views/partials/emailer/inbox-emailer.html",link:function(n){n.$watch("emailer",(function(t){n.me=t&&t.email&&t.email===e.user.preferredEmail}))}}}]).directive("inboxEmailerAvatar",(function(){return{restrict:"E",controller:"resolveEmailerController",controllerAs:"$ctrl",scope:{emailer:"="},templateUrl:"/unifiedinbox/views/partials/emailer/inbox-emailer-avatar.html"}})).directive("inboxEmailerAvatarPopover",(function(){return{restrict:"E",controller:"resolveEmailerController",controllerAs:"$ctrl",scope:{emailer:"="},templateUrl:"/unifiedinbox/views/partials/emailer/inbox-emailer-avatar-popover.html"}})).directive("inboxEmailerGroup",(function(){return{restrict:"E",replace:!0,scope:{group:"=",displayInline:"@?"},templateUrl:"/unifiedinbox/views/partials/emailer/inbox-emailer-group.html"}})).directive("inboxEmailerDisplay",["emailSendingService","_",function(e,n){return{restrict:"E",scope:{email:"="},templateUrl:"/unifiedinbox/views/partials/emailer/inbox-emailer-display.html",link:function(t){var i={to:"To",cc:"CC",bcc:"BCC"},o=n.keys(i);(function(e){for(var n=0;n<o.length;n++){var r=o[n],a=e(t.email[r]);if(a){t.previewEmailer=a,t.previewEmailerGroup=i[r];break}}})(n.head),t.collapsed=!0,t.numberOfHiddenEmailer=e.countRecipients(t.email)-1,t.showMoreButton=t.numberOfHiddenEmailer>0}}}]).directive("attachmentDownloadAction",(function(){return{restrict:"E",replace:!0,templateUrl:"/unifiedinbox/views/attachment/attachment-download-action.html"}})).directive("inboxAttachment",(function(){return{restrict:"E",replace:!0,scope:{attachment:"="},controller:"attachmentController",controllerAs:"ctrl",templateUrl:"/unifiedinbox/views/attachment/inbox-attachment.html"}})).directive("recipientsAutoComplete",["_","elementScrollService","searchService","emailService",function(e,n,t,i){return{restrict:"E",scope:{tags:"=ngModel",excludedEmails:"=",addClass:"=?",onEmailAdded:"=",onEmailRemoved:"=",ignoreEmailFormat:"=?"},templateUrl:"/unifiedinbox/views/composer/recipients-auto-complete.html",link:function(o,r){function a(e){Object.keys(e).forEach((function(n){if(!e.email&&"name"===n){var t=[];if(e.name=e.name.replace(/(.*?)<(.*?)>/g,(function(e,n,i){return n=n.trim(),i=i.trim(),n.length||(n=i),t.push({name:n,email:i}),""})),!e.name){var i=t.pop();e.email=i.email,e.name=i.name}t.forEach((function(e){o.tags.push(e)}))}})),e.email?(!e.name||e.name&&!e.name.trim())&&(e.name=e.email):(e.name=e.name.trim(),e.email=e.name)}o.tags=o.tags||[],o.excludes=o.tags.map((function(e){if(e.id&&e.objectType)return{id:e.id,objectType:e.objectType}})).filter(Boolean),o.tags.filter((function(e){return e.email})).forEach(a),o.search=function(e){return t.searchRecipients(e,o.excludes)},o.onTagAdding=function(n){return a(n),!(!o.ignoreEmailFormat&&!i.isValidEmail(n.email))&&(!(o.excludedEmails&&o.excludedEmails.indexOf(n.email)>-1)&&!e.find(o.tags,{email:n.email}))},o.onTagAdded=function(e){e.id&&e.objectType&&o.excludes.push({id:e.id,objectType:e.objectType}),n.autoScrollDown(r.find("div.tags")),o.onEmailAdded&&o.onEmailAdded(e)},o.onTagRemoved=function(n){e.remove(o.excludes,(function(e){return e.id===n.id})),o.onEmailRemoved&&o.onEmailRemoved(n)}}}}]).directive("emailBodyEditor",["emailBodyService",function(e){function n(e){return"/unifiedinbox/views/composer/editor/"+e+".html"}return{restrict:"E",templateUrl:function(){return e.supportsRichtext()?n("richtext"):n("plaintext")}}}]).directive("inboxStar",["inboxJmapItemService",function(e){return{restrict:"E",controller:["$scope",function(n){this.setIsFlagged=function(t){e.setFlag(n.item,"isFlagged",t)}}],controllerAs:"ctrl",scope:{item:"="},templateUrl:"/unifiedinbox/views/partials/inbox-star.html"}}]).directive("email",["inboxJmapItemService","navigateTo",function(e,n){return{restrict:"E",controller:["$scope",function(t){["reply","replyAll","forward"].forEach(function(n){this[n]=function(){e[n](t.email)}}.bind(this)),this.toggleIsCollapsed=function(e){angular.isDefined(e.isCollapsed)&&(e.isCollapsed=!e.isCollapsed,t.$broadcast("email:collapse",e.isCollapsed))},this.download=function(){e.downloadEML(t.email).then(n)}}],controllerAs:"ctrl",scope:{email:"="},templateUrl:"/unifiedinbox/views/partials/email.html"}}]).directive("inboxIndicators",(function(){return{restrict:"E",replace:!0,templateUrl:"/unifiedinbox/views/partials/inbox-indicators.html",scope:{item:"=",hiddenXl:"@"}}})).directive("inboxEmailFooter",["inboxJmapItemService",function(e){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/email-footer.html",scope:{email:"="},controller:["$scope","esnShortcuts","INBOX_SHORTCUTS_ACTIONS_CATEGORY",function(n,t,i){["reply","replyAll","forward"].forEach(function(t){this[t]=function(){e[t](n.email)}}.bind(this)),t.use(i.shortcuts.REPLY_EMAIL,this.reply,n),t.use(i.shortcuts.REPLY_ALL_EMAIL,this.replyAll,n),t.use(i.shortcuts.FORWARD_EMAIL,this.forward,n)}],controllerAs:"ctrl"}}]).directive("inboxFilterButton",["$rootScope","_","esnI18nService","INBOX_EVENTS",function(e,n,t,i){return{restrict:"E",templateUrl:"/unifiedinbox/views/filter/filter-button.html",scope:{filters:"=",placeholder:"@"},controllerAs:"ctrl",controller:["$scope",function(o){var r=o.placeholder||"Filters";function a(){var e=n.filter(o.filters,{checked:!0}),i=t.translate("%s selected",e.length).toString();e.length>0?(o.dropdownList.filtered=!0,o.dropdownList.placeholder=1===e.length?e[0].displayName:i):(o.dropdownList.filtered=!1,o.dropdownList.placeholder=r)}o.dropdownList={},o.$on(i.FILTER_CHANGED,a),this.dropdownItemClicked=function(){a(),e.$broadcast(i.FILTER_CHANGED)},a()}]}}]).directive("inboxEmptyContainerMessage",["$stateParams","inboxFilteringService","inboxPlugins",function(e,n,t){return{restrict:"E",scope:{},templateUrl:"/unifiedinbox/views/partials/empty-messages/index.html",link:function(i){var o=t.get(e.type);i.isFilteringActive=n.isFilteringActive,o?o.getEmptyContextTemplateUrl(e.account,e.context).then((function(e){i.containerTemplateUrl=e})):i.containerTemplateUrl="/unifiedinbox/views/partials/empty-messages/containers/inbox.html"}}}]).directive("inboxClearFiltersButton",["inboxFilteringService",function(e){return{restrict:"E",scope:{},controller:function(){this.clearFilters=function(){e.clearFilters()}},controllerAs:"ctrl",templateUrl:"/unifiedinbox/views/filter/inbox-clear-filters-button.html"}}]).directive("inboxHomeButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/inbox-home-button.html"}})).directive("inboxListAccountUnavailable",(function(){return{restrict:"E",scope:{account:"="},templateUrl:"/unifiedinbox/views/partials/empty-messages/inbox-list-account-unavailable.html"}}))},r2TF:function(e,n){!function(e){"use strict";function n(n,t,i,o,r,a,s){var u,l=this;l.init=function(){l.userDisplayName=o.displayNameOf(i),l.status="loading",s.listUserForwardings(i._id,n.domainId).then((function(n){l.status="loaded",l.forwardings=n.data,u=e.copy(l.forwardings)})).catch((function(){l.status="error"}))},l.updateUserForwardings=function(){var e={};if(e.forwardingsToAdd=t.difference(l.forwardings,u),e.forwardingsToRemove=t.difference(u,l.forwardings),!e.forwardingsToAdd.length&&!e.forwardingsToRemove.length)return;return r({progressing:"Updating forwardings...",success:"Forwardings updated",failure:"Failed to update forwardings"},(function(){return a.updateUserForwardings(e,i._id,n.domainId)}))},l.user=i}n.$inject=["$stateParams","_","user","userUtils","asyncAction","inboxForwardingsService","inboxForwardingClient"],e.module("linagora.esn.unifiedinbox").controller("InboxForwardingsUserController",n)}(angular)},"rM/8":function(e,n){!function(e){"use strict";function n(n,t,i,o,r,a,s,u){return function(){function e(){this.uploadAttachments=l.bind(this),this._uploadLargeFiles=c.bind(this),this._upload=d.bind(this)}return e.prototype.constructor=e,new e}();function l(s,l){if(!s||0===s.length)return n.resolve([]);var c=this;return l="function"==typeof l?l:e.noop,a((function(e){return r("maxSizeUpload",u).then((function(i){var r=[],a=[],u=t("bytes")(i);s.forEach((function(n){if(n.size>i)return r.push(n);var t=o.getDefault().fileToAttachment(e,n);return c._upload(t).then(l),a.push(t)}));var d=r.length>0?c._uploadLargeFiles(r,u,l):n.when([]);return n.all([n.when(a),d])})).then((function(e){return i.union(e[0],e[1])}))}))}function c(e,t,i){var o=this;return n((function(n){s.show(e,t,(function(e,t){n(t&&t.map((function(n){var t=e.fileToAttachment(n);return o._upload(t).then(i),t})))}),(function(){n([])}))}))}function d(t){t.status="uploading",t.upload={progress:0};var i=o.get(t.attachmentType),r=i&&i.upload;if(r){var a=r(t);t.upload.cancel=a.cancel,t.upload.promise=a.promise.then((function(){t.status="uploaded"}),(function(){t.status="error"}),(function(e){t.upload.progress=e}))}else t.status="error",t.upload.cancel=e.noop,t.upload.promise=n.reject(new Error("No uploader for this attachment type: "+t.attachmentType));return t.upload.promise}}n.$inject=["$q","$filter","_","inboxAttachmentProviderRegistry","inboxConfig","withJmapClient","inboxAttachmentAlternativeUploaderModal","DEFAULT_MAX_SIZE_UPLOAD"],e.module("linagora.esn.unifiedinbox").factory("inboxAttachmentUploadService",n)}(angular)},rspv:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").factory("inboxForwardingsService",["$q","inboxForwardingClient",function(e,n){return{update:function(t){return e.all(t.forwardingsToAdd.map((function(e){return n.addForwarding(e)})).concat(t.forwardingsToRemove.map((function(e){return n.removeForwarding(e)}))))},updateUserForwardings:function(t,i,o){return e.all(t.forwardingsToAdd.map((function(e){return n.addUserForwarding(e,i,o)})).concat(t.forwardingsToRemove.map((function(e){return n.removeUserForwarding(e,i,o)}))))}}}])}(angular)},sCbM:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("InboxDraft",["$rootScope","$q","_","emailBodyService","asyncJmapAction","inboxJmapHelper","waitUntilMessageIsComplete","inboxConfig","gracePeriodService","INBOX_EVENTS","ATTACHMENTS_ATTRIBUTES",function(e,n,t,i,o,r,a,s,u,l,c){function d(e){this.original=e?angular.copy(e):{}}return d.prototype.needToBeSaved=function(e){var o=this.original,r=e||{};return n((function(e,n){if(p(o.subject)!==p(r.subject)||function(e,n){return p(e[i.bodyProperty])!==p(n[i.bodyProperty])}(o,r)||m(o.to,r.to)||m(o.cc,r.cc)||m(o.bcc,r.bcc)||function(e,n){return!t.isEqual(f(e,c),f(n,c))}(o.attachments,r.attachments))return e();n()}))},d.prototype.save=function(n,t){var i,s=this;return g().then(s.needToBeSaved.bind(s,n)).then((function(){e.$broadcast(l.DRAFT_DESTROYED,s.original)})).then(a.bind(null,n)).then((function(){return o("Saving your email as draft",(function(e){return r.toOutboundMessage(e,n).then((function(n){return e.saveAsDraft(n).then((function(e){i=e.id}))}))}),t)})).then((function(){if(s.original.id)return o("Destroying a draft",(function(e){return e.destroyMessage(s.original.id)}),{silent:!0})})).then((function(){return r.getMessageById(i)})).then((function(n){s.original=n,e.$broadcast(l.DRAFT_CREATED,n)}))},d.prototype.destroy=function(t){var i=this;return g().then((function(){if(!t||!t.silent)return u.askUserForCancel("This draft has been discarded","Reopen").promise.then((function(e){if(e.cancelled)return n.reject()}))})).then((function(){if(i.original.id)return o("Destroying a draft",(function(e){return e.destroyMessage(i.original.id)}),{silent:!0})})).then((function(){e.$broadcast(l.DRAFT_DESTROYED,i.original)}))},d;function f(e,n){return t.map(e,(function(e){return t.pick(e,n)}))}function m(e,n){return t.xor(t.map(e,"email"),t.map(n,"email")).length>0}function p(e){return(e||"").trim()}function g(){return s("drafts").then((function(e){return e?n.when():n.reject()}))}}])}()},sOZ5:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxComposerController",["$q","_","notificationFactory","emailSendingService","inboxRequestReceiptsService","esnAttachmentsSelectorService","emailBodyService","Offline","inboxAttachmentUploadService","waitUntilMessageIsComplete","backgroundAction","InboxDraft","inboxAttachmentProviderRegistry","inboxEmailComposingHookService","DRAFT_SAVING_DEBOUNCE_DELAY","INBOX_ATTACHMENT_TYPE_JMAP",function(e,n,t,i,o,r,a,s,u,l,c,d,f,m,p,g){var b=this,h=!1;function x(){var e={persist:!0,silent:!0,onFailure:{linkText:"Reopen the composer",action:b.onShow},onClose:b.forceClose};return y(),b.draft.save(b.message,e).then((function(){b.message=n.assign({},b.message,b.draft.original),b.onMessageIdUpdate({$id:b.message.id})})).then(b.onSave)}function v(e){S(),n.forEach(b.message.attachments,E),b.draft.destroy(e).then(b.onDiscard,b.onShow)}function E(e){e.upload&&e.upload.cancel()}function S(){h=!0,b.onHide()}function A(){if(!b.message.isQuoting&&b.message.quoted)return a.quoteOriginalEmail(b.message).then((function(e){return b.message.textBody="",b.message.htmlBody=e,b.message}))}function I(e){b.message.attachments=n.uniq((b.message.attachments||[]).concat(e))}function y(){b.hasRequestedReadReceipt?i.addReadReceiptRequest(b.message):i.removeReadReceiptRequest(b.message)}b.$onInit=function(){m.preComposing(b.message),b.onTryClose({callback:b.tryClose}),b.draft=new d(b.message),b.isCollapsed=!b.message||n.isEmpty(b.message.cc)&&n.isEmpty(b.message.bcc),b.onTitleUpdate({$title:b.message&&b.message.subject}),o.getDefaultReceipts().then((function(e){b.hasRequestedReadReceipt=e.isRequestingReadReceiptsByDefault||i.getReadReceiptRequest(b.message,{asCurrentUser:!0})})),b.attachmentHolder=r.newAttachmentServiceHolder({get attachments(){return b.message&&b.message.attachments?b.message.attachments:[]},set attachments(e){I(e)},attachmentType:g,attachmentFilter:{isInline:!1},onAttachmentsUpdate:I,uploadAttachments:u.uploadAttachments})},b.tryClose=function(){if(!h)return x();return e.when()},b.saveDraft=n.debounce(x,p),b.onAttachmentsUpload=function(e){return u.uploadAttachments(e).then((function(e){return I(e),b.message.attachments}))},b.removeAttachment=function(e){var t=f.get(e.attachmentType);t&&t.removeAttachment&&t.removeAttachment(b.message,e),n.pull(b.message.attachments,e),E(e)},b.send=function(){if(b.isSendingMessage=!0,function(){if(i.noRecipient(b.message))t.weakError("Note","Your email should have at least one recipient");else{if(s.state&&"down"!==s.state)return!0;t.weakError("Note","Your device has lost Internet connection. Try later!")}}())return S(),y(),i.removeDuplicateRecipients(b.message),c({progressing:"Your message is being sent...",success:"Message sent",failure:function(){return s.state&&"down"!==s.state?"Your message cannot be sent":"You have been disconnected. Please check if the message was sent before retrying"}},(function(){return l(b.message).then(A).then(i.sendEmail.bind(i,b.message))}),{persist:!0,onFailure:{linkText:"Reopen the composer",action:b.onShow}}).then(v.bind(b,{silent:!0})).then(b.onSend);b.isSendingMessage=!1},b.destroyDraft=v,b.toggleReadReceiptRequest=function(){b.hasRequestedReadReceipt=!b.hasRequestedReadReceipt}}])}()},svsH:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").constant("INBOX_PERSONAL_MAILBOX_NAMESPACE_TYPE","personal").constant("INBOX_MAILBOX_SHARING_ROLES",{READ_AND_UPDATE:"READ_AND_UPDATE",READ_AND_UPDATE_LABEL:"Consultation",READ_AND_UPDATE_LABEL_LONG:"Read and update messages",ORGANIZE:"ORGANIZE",ORGANIZE_LABEL:"Organize",ORGANIZE_LABEL_LONG:"Consultation and organize folder"}).constant("INBOX_MAILBOX_SHARING_PERMISSIONS",{READ_AND_UPDATE:["l","r","w"],ORGANIZE:["l","r","w","i","e","t"]})}()},tZti:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxSidebarUnifiedinboxButton",{templateUrl:"/unifiedinbox/app/components/sidebar/unifiedinbox-button/unifiedinbox-button.html"})}(angular)},uFIX:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxForwardingsUser",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/forwardings/user/inbox-forwardings-user.html",bindings:{user:"<"}})}(angular)},uRHS:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").directive("inboxDraggableListItem",["inboxSelectionService","esnI18nService",function(e,n){return{restrict:"A",link:function(t){t.getDragData=function(){return e.isSelecting()?(t.$apply((function(){e.toggleItemSelection(t.item,!0)})),e.getSelectedItems()):[t.item]},t.getDragMessage=function(e){return e.length>1?n.translate("%s items",e.length):e[0].subject||n.translate("1 item")}}}}]).directive("inboxSwipeableListItem",["inboxConfig",function(e){return{restrict:"A",controller:["$scope","$element",function(e,n){e.onSwipeLeft=function(){var t=e.$on("action-list.hide",(function(){e.swipeClose(),t()}));n.controller("actionList").open()}}],link:function(n){e("swipeRightAction","markAsRead").then((function(e){n.leftTemplate="/unifiedinbox/views/partials/swipe/left-template-"+e+".html"}))}}}]).directive("inboxMessageListItem",["$state","$stateParams","newComposerService","_","inboxJmapItemService","inboxSwipeHelper","inboxMailboxesService","inboxSelectionService",function(e,n,t,i,o,r,a,s){return{restrict:"E",controller:["$scope",function(u){var l=this,c=n.context;function d(e){var n=u.email;return c?e(c):!n||n.mailboxIds.every((function(n){return e(n)}))}u.mailbox=n.mailbox||u.mailbox&&u.mailbox.id||u.item&&i.first(u.item.mailboxIds),u.email=u.item,l.select=function(e,n){n.stopPropagation(),n.preventDefault(),n.shiftKey?s.groupSelection(e):s.toggleItemSelection(e)},l.openDraft=function(e){t.openDraft(e)},["reply","replyAll","forward","markAsUnread","markAsRead","markAsFlagged","unmarkAsFlagged","moveToTrash","moveToSpam","unSpam"].forEach((function(e){l[e]=function(){o[e](u.item)}})),l.move=function(){e.go(".move",{item:u.item})},u.onSwipeRight=r.createSwipeRightHandler(u,{markAsRead:l.markAsRead,moveToTrash:l.moveToTrash}),l.canTrashMessages=function(){return d(a.canTrashMessages)},l.canMoveMessagesOutOfMailbox=function(){return d(a.canMoveMessagesOutOfMailbox)},l.canMoveMessageToSpam=function(){return d(a.canMoveMessagesOutOfMailbox)},l.canUnSpamMessages=function(){return d(a.canUnSpamMessages)}}],controllerAs:"ctrl",templateUrl:"/unifiedinbox/views/email/list/list-item.html"}}]).directive("inboxThreadListItem",["$state","$stateParams","newComposerService","_","inboxJmapItemService","inboxSwipeHelper","inboxSelectionService",function(e,n,t,i,o,r,a){return{restrict:"E",controller:["$scope",function(s){var u=this;s.mailbox=n.mailbox||s.mailbox&&s.mailbox.id||s.item&&i.first(s.item.lastEmail.mailboxIds),s.thread=s.item,u.select=function(e,n){n.stopPropagation(),n.preventDefault(),a.toggleItemSelection(e)},u.openDraft=function(e){t.openDraft(e)},["markAsUnread","markAsRead","markAsFlagged","unmarkAsFlagged","moveToTrash"].forEach((function(e){u[e]=function(){o[e](s.item)}})),u.move=function(){e.go(".move",{item:s.item})},s.onSwipeRight=r.createSwipeRightHandler(s,{markAsRead:u.markAsRead,moveToTrash:u.moveToTrash})}],controllerAs:"ctrl",templateUrl:"/unifiedinbox/views/thread/list/list-item.html"}}])},uYJZ:function(e,n){!function(e){"use strict";function n(n,t){var i=[];return{isSelecting:function(){return!!i.length},getSelectedItems:function(){return n.clone(i)},toggleItemSelection:function(t,o){var r=e.isDefined(o)?o:!t.selected;if(t.selected===r)return;t.selected=r,r?i.push(t):n.pull(i,t)},groupSelection:function(e){if(!e||!e.id)return-1;var a=t.list(),s=n.findIndex(a,{id:e.id});if(-1===s)return-1;if(!i.length)return o(e);if(1===i.length&&i[0].id===e.id)return r(e);if(0===s&&i.length>0&&f(s+1))return e.selected?r(e):o(e);if(s>0&&(u=s,a.length>u+1)&&f(s-1)&&f(s+1))return e.selected?r(e):o(e);var u;var l=n.findLastIndex(a,"selected"),c=function(e){for(;++e<a.length;)if(a[e].selected)return e;return-1}(s);s>l?d(l,s):c>s&&d(s,c);function d(e,n){for(var t=e;t<n+1;t++)o(a[t])}function f(e){return a[e]&&a[e].selected}},unselectAllItems:function(){i.forEach((function(e){e.selected=!1})),i.length=0}};function o(e){if(e.selected)return-1;e.selected=!0,i.push(e)}function r(e){e.selected=!1,n.remove(i,(function(n){return n.id===e.id}))}}n.$inject=["_","inboxFilteredList"],e.module("linagora.esn.unifiedinbox").factory("inboxSelectionService",n)}(angular)},ueGl:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSharedMailboxesSubheader",{templateUrl:"/unifiedinbox/app/components/shared-mailboxes/subheader/shared-mailboxes-subheader.html",bindings:{onSave:"&"}})}()},upAi:function(e,n){!function(e){"use strict";function n(e,n,t,i,o,r){var a=this;i.all([t("forwarding",!1),t(o,r)]).then((function(e){a.isForwardingEnabled=e[0],a.isFoldersSharingEnabled=e[1]})),e.hasTouchscreen=n.hasTouchscreen()}n.$inject=["$scope","touchscreenDetectorService","inboxConfig","$q","INBOX_FOLDERS_SHARING_CONFIG_KEY","INBOX_DEFAULT_FOLDERS_SHARING_CONFIG"],e.module("linagora.esn.unifiedinbox").controller("inboxConfigurationController",n)}(angular)},utKG:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").directive("inboxSidebarEmail",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/sidebar/email/menu.html",controller:"inboxSidebarEmailController",controllerAs:"ctrl"}})).directive("inboxSidebarConfigurationButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/sidebar/configuration/configuration-button.html"}})).directive("inboxSidebarNewFolderButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/sidebar/configuration/new-folder-button.html"}}))},v0Om:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").directive("inboxComposerBoxed",["$timeout","ESN_BOX_OVERLAY_EVENTS",function(e,n){return{restrict:"A",require:"inboxComposer",link:function(t,i,o,r){function a(e){var n;t.lastFocused={node:e.target,isFoldable:(n=e.target,angular.element(n).closest("recipients-auto-complete").length>0&&!t.isCollapsed)}}e((function(){r.message&&r.message.to&&0!==r.message.to.length?i.find(".summernote").summernote("focus"):i.find(".recipients-to input").focus()}),0),i.context.children[0].addEventListener("focusin",a,!0),t.$on(n.RESIZED,(function(){t.lastFocused&&t.lastFocused.node&&(t.lastFocused.isFoldable&&t.isCollapsed&&(t.isCollapsed=!1),e((function(){t.lastFocused.node.focus()}),350))}))}}}])}()},vSqU:function(e,n){!function(e){"use strict";function n(e){var n=this;n.getFilterSummary=function(){return e.getFilterSummary(n.filter)}}n.$inject=["inboxMailboxesFilterService"],e.module("linagora.esn.unifiedinbox").controller("inboxConfigurationFilterCardController",n)}(angular)},vapZ:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxSubheaderNotSpamButton",{templateUrl:"/unifiedinbox/app/components/subheader/not-spam-button/subheader-not-spam-button.html"})}()},vhC1:function(e,n){!function(e){"use strict";function n(n,t,i){return function(){var o=this;return n.resolveEmail(o.email).catch(e.noop).then((function(e){o.objectType=e&&e.objectType?e.objectType:"email","user"!==o.objectType&&(o.name=e&&e.names&&e.names[0]&&e.names[0].displayName||o.name),o.id=e&&e.id,o.avatarUrl=e&&e.photos&&e.photos[0]&&e.photos[0].url||t.generateUrl(o.email,o.name)})).then((function(){return{id:"user"===o.objectType&&o.id,email:o.email,url:(e=o.avatarUrl,n=i,e.split("?").length>1?e+"&size="+n:e+"?size="+n)};var e,n}))}}n.$inject=["inboxCacheService","esnAvatarUrlService","INBOX_AVATAR_SIZE"],e.module("linagora.esn.unifiedinbox").factory("inboxEmailerResolver",n)}(angular)},voSL:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").factory("generateJwtToken",["$http","_","httpConfigurer",function(e,n,t){return function(){return e.post(t.getUrl("/api/jwt/generate")).then(n.property("data"))}}])}()},wVTr:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").filter("sanitizeStylisedHtml",["$sce","_",function(e,n){return function(t){return e.trustAsHtml(sanitizeHtml(t,{allowedTags:sanitizeHtml.defaults.allowedTags.concat(["img","h1","span","u","font"]),allowedAttributes:n.extend(sanitizeHtml.defaults.allowedAttributes,{"*":["style"],font:["color","size","face"],img:sanitizeHtml.defaults.allowedAttributes.img.concat(["width","height"]),a:sanitizeHtml.defaults.allowedAttributes.a.concat(["href"])}),selfClosing:["img","br","hr","area","base","basefont","input","link","meta"],allowedSchemesByTag:{img:sanitizeHtml.defaults.allowedSchemes.concat(["data"])}}))}}])}(angular)},"x/4Y":function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxReadReceipt",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/read-receipt/read-receipt.html",controller:"inboxReadReceiptController",bindings:{message:"<"}})}()},x0CY:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxIdentityFormSubheader",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/identity/form/subheader/identity-form-subheader.html",bindings:{identityId:"@",onSave:"&",form:"<"}})}()},xuUh:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").controller("inboxQuotaBannerController",["inboxUserQuotaService",function(e){var n=this;n.$onInit=function(){e.getUserQuotaInfo().then((function(e){e.quotaLevel&&(n.quotaLevel=e.quotaLevel)}))}}])}()},y55o:function(e,n){!function(e){"use strict";function n(e,n,t){return function(){return{type:t.SEARCH,contextSupportsAttachments:n.constant(e.when(!1)),resolveContextName:function(){return e.when("Search results")},resolveContextRole:function(){return e.when()},getEmptyContextTemplateUrl:function(){return e.when("/unifiedinbox/app/search/empty/search-empty-message.html")}}}}n.$inject=["$q","_","PROVIDER_TYPES"],e.module("linagora.esn.unifiedinbox").factory("inboxSearchPluginService",n)}(angular)},y97W:function(e,n){!function(e){"use strict";function n(n,t,i,o,r){var a,s=this;s.user=t.user,s.$onInit=function(){s.status="loading",r.list().then((function(n){s.status="loaded",s.forwardings=n.data,a=e.copy(s.forwardings)})).catch((function(){s.status="error"}))},s.onSave=function(){var t={};if(t.forwardingsToAdd=n.difference(s.forwardings,a),t.forwardingsToRemove=n.difference(a,s.forwardings),!t.forwardingsToAdd.length&&!t.forwardingsToRemove.length)return;return i({progressing:"Updating forwardings...",success:"Forwardings updated",failure:"Failed to update forwardings"},(function(){return o.update(t)})).then((function(){a=e.copy(s.forwardings)}))}}n.$inject=["_","session","asyncAction","inboxForwardingsService","inboxForwardingClient"],e.module("linagora.esn.unifiedinbox").controller("InboxForwardingsController",n)}(angular)},yOLm:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").filter("emailer",["emailBodyService",function(e){return function(n){if(n)return n.name?n.name.concat(e.supportsRichtext()?" &lt;":" <",n.email,e.supportsRichtext()?"&gt;":">"):n.email}}]).filter("emailerList",["$filter",function(e){return function(n,t){if(0!==(n=n||[]).length){var i=n.map(e("emailer")).join(", ");return t&&(i=t+i),i}}}]).filter("nl2br",(function(){return function(e){return e&&e.trim?e.trim().replace(/([^>\r\n]?)(\r\n|\r|\n)/gm,"$1<br/>"):e}})).filter("loadImagesAsync",["absoluteUrl",function(e){var n=e("/images/throbber-amber.svg");return function(e){return e.replace(/<img([^]*?)src=["']([^]+?)["']/gim,'<img$1src="'+n+'" data-async-src="$2"')}}]).filter("inboxFilterRestrictedMailboxes",["inboxMailboxesService","_",function(e,n){return function(t){return n.filter(t,(function(n){return e.canMoveMessagesIntoMailbox(n.id)}))}}])},yS6E:function(e,n){!function(){"use strict";function e(e){var n=[],t=[];return{registerPreSendingHook:function(e){if("function"!=typeof e)throw new TypeError("Hook must be a function");n.push(e)},registerPostSendingHook:function(e){if("function"!=typeof e)throw new TypeError("Hook must be a function");t.push(e)},preSending:function(t){return e.all(n.map((function(e){return e(t)}))).then((function(){return t}))},postSending:function(n){return e.all(t.map((function(e){return e(n)}))).then((function(){return n}))}}}e.$inject=["$q"],angular.module("linagora.esn.unifiedinbox").factory("inboxEmailSendingHookService",e)}()},yWm4:function(e,n,t){"use strict";angular.module("linagora.esn.unifiedinbox").directive("unifiedViewSubheader",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/unified-inbox/subheader.html",controller:"inboxListSubheaderController",controllerAs:"ctrl"}})).directive("viewEmailSubheader",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/email/view/subheader.html"}})).directive("viewThreadSubheader",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/thread/view/subheader.html"}})).directive("composerSubheader",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/composer/subheader.html"}})).directive("inboxConfigurationVacationSubheader",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/configuration/vacation/subheader.html"}})).directive("fullscreenEditFormSubheader",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/composer/fullscreen-edit-form/subheader.html"}})).directive("inboxSubheaderCloseButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/subheader/close-button.html"}})).directive("inboxSubheaderBurgerButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/subheader/burger-button.html"}})).directive("inboxSubheaderBackButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/subheader/back-button.html"}})).directive("inboxSubheaderSaveButton",(function(){return{restrict:"E",templateUrl:"/unifiedinbox/views/partials/subheader/save-button.html"}}))},yx6k:function(e,n){!function(){"use strict";angular.module("linagora.esn.unifiedinbox").component("inboxComposerBodyEditorHtml",{templateUrl:"/unifiedinbox/app/components/composer/body-editor/html/composer-body-editor-html.html",controller:"inboxComposerBodyEditorHtmlController",bindings:{message:"<",identity:"<",isCollapsed:"<",send:"&",upload:"&",removeAttachment:"&",onBodyUpdate:"&",onAttachmentsUpload:"&"}})}()},yxnX:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").component("inboxIdentitiesTab",{templateUrl:"/unifiedinbox/app/components/inbox-configuration/identities/tab/inbox-identities-tab.html"})}(angular)},z33q:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").directive("inboxSearchMessageListItem",(function(){return{controllerAs:"ctrl",controller:"inboxSearchMessageListItemController",templateUrl:"/unifiedinbox/app/search/message-list-item/message-list-item.html"}}))}(angular)},zFhF:function(e,n){!function(){"use strict";function e(e,n){this.mailbox=e.context,this.providerType=n.JMAP}e.$inject=["$stateParams","PROVIDER_TYPES"],angular.module("linagora.esn.unifiedinbox").controller("inboxListSidebarAttachmentController",e)}()},zk79:function(e,n){!function(e){"use strict";e.module("linagora.esn.unifiedinbox").constant("INBOX_ATTACHMENT_TYPE_JMAP","jmap")}(angular)}});